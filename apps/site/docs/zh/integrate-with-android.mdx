# é›†æˆåˆ° Android

import { PackageManagerTabs } from '@theme';

:::info æ ·ä¾‹é¡¹ç›®
ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å‘ Android é›†æˆçš„æ ·ä¾‹é¡¹ç›®ï¼š[https://github.com/web-infra-dev/midscene-example/blob/main/android-demo](https://github.com/web-infra-dev/midscene-example/blob/main/android-demo)

è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª Android å’Œ Vitest ç»“åˆçš„æ ·ä¾‹é¡¹ç›®ï¼š[https://github.com/web-infra-dev/midscene-example/tree/main/android-with-vitest-demo](https://github.com/web-infra-dev/midscene-example/tree/main/android-with-vitest-demo)
:::

## å‡†å¤‡å·¥ä½œ

### é…ç½® OpenAI API Key

é…ç½® OpenAI API Keyï¼Œæˆ– [è‡ªå®šä¹‰æ¨¡å‹å’ŒæœåŠ¡å•†](./model-provider)

```bash
# æ›´æ–°ä¸ºä½ è‡ªå·±çš„ Key
export OPENAI_API_KEY="sk-abcdefghijklmnopqrstuvwxyz"
```

### å‡†å¤‡ adb ç¯å¢ƒ

- æ–¹å¼ä¸€ï¼šä½¿ç”¨ [Android Studio](https://developer.android.com/studio?hl=zh-cn) å®‰è£…
- æ–¹å¼äºŒï¼šä½¿ç”¨ [Android command-line tools](https://developer.android.com/studio#command-line-tools-only) å®‰è£…

éªŒè¯ adb æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```bash
adb --version
```

è¾“å‡ºå¦‚ä¸‹ï¼Œè¯´æ˜ adb å®‰è£…æˆåŠŸ

```bash
Android Debug Bridge version 1.0.41
Version 34.0.4-10411341
Installed as /usr/local/bin//adb
Running on Darwin 24.3.0 (arm64)
```

### ä½¿ç”¨ adb è¿æ¥ Android è®¾å¤‡

æ‰“å¼€å®‰å“è®¾å¤‡çš„ USB è°ƒè¯•ï¼Œæ¥ç€ä½¿ç”¨æ•°æ®çº¿è¿æ¥ä¸€å°å®‰å“è®¾å¤‡

é€šè¿‡ä¸‹é¢å‘½ä»¤ç¡®è®¤å·²ç»è¿æ¥ï¼š

```bash
adb devices -l
```

è¾“å‡ºå¦‚ä¸‹ï¼Œè¯´æ˜è¿æ¥æˆåŠŸ

```bash
List of devices attached
s4ey59ytbitot4yp	device usb:34603008X product:cezanne model:M2006J10C device:cezanne transport_id:3
```

## ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–

<PackageManagerTabs command="install @midscene/android --save-dev" />

## ç¬¬äºŒæ­¥ï¼šç¼–å†™è„šæœ¬

ç¼–å†™ä¸‹æ–¹ä»£ç ï¼Œä¿å­˜ä¸º `./demo.ts`

```typescript title="./demo.ts"
import { AndroidAgent, AndroidDevice, getConnectedDevices } from '@midscene/android';

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));
Promise.resolve(
  (async () => {
    const devices = await getConnectedDevices();
    const page = new AndroidDevice(devices[0].udid);

    // ğŸ‘€ åˆå§‹åŒ– Midscene agent
    const agent = new AndroidAgent(page,{
      aiActionContext:
        'å¦‚æœå‡ºç°ä½ç½®ã€æƒé™ã€ç”¨æˆ·åè®®ç­‰å¼¹çª—ï¼Œç‚¹å‡»åŒæ„ã€‚å¦‚æœå‡ºç°ç™»å½•é¡µé¢ï¼Œå…³é—­å®ƒã€‚',
    });
    await page.connect();

    // ğŸ‘€ æ‰“å¼€æµè§ˆå™¨å¹¶å¯¼èˆªåˆ° ebay.comï¼ˆè¯·ç¡®ä¿å½“å‰é¡µé¢æœ‰æµè§ˆå™¨ App å–”ï¼‰
    await agent.aiAction('open browser and navigate to ebay.com');

    await sleep(5000);

    // ğŸ‘€ è¾“å…¥å…³é”®è¯ï¼Œæ‰§è¡Œæœç´¢
    await agent.aiAction('åœ¨æœç´¢æ¡†è¾“å…¥ "Headphones" ï¼Œæ•²å›è½¦');

    // ğŸ‘€ ç­‰å¾…åŠ è½½å®Œæˆ
    await agent.aiWaitFor("é¡µé¢ä¸­è‡³å°‘æœ‰ä¸€ä¸ªè€³æœºå•†å“");
    // æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„ sleep:
    // await sleep(5000);

    // ğŸ‘€ ç†è§£é¡µé¢å†…å®¹ï¼Œæå–æ•°æ®
    const items = await agent.aiQuery(
      "{itemTitle: string, price: Number}[], æ‰¾åˆ°åˆ—è¡¨é‡Œçš„å•†å“æ ‡é¢˜å’Œä»·æ ¼"
    );
    console.log("è€³æœºå•†å“ä¿¡æ¯", items);

    // ğŸ‘€ ç”¨ AI æ–­è¨€
    await agent.aiAssert("ç•Œé¢å·¦ä¾§æœ‰ç±»ç›®ç­›é€‰åŠŸèƒ½");
  })()
);

```

æ›´å¤š Agent çš„ API è®²è§£è¯·å‚è€ƒ [API å‚è€ƒ](./API)ã€‚

## ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œ

ä½¿ç”¨ `tsx` æ¥è¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°å‘½ä»¤è¡Œæ‰“å°å‡ºäº†è€³æœºçš„å•†å“ä¿¡æ¯ï¼š

```bash
# run
npx tsx demo.ts

# å‘½ä»¤è¡Œåº”è¯¥æœ‰å¦‚ä¸‹è¾“å‡º
#  [
#   {
#     itemTitle: 'JBL Tour Pro 2 - True wireless Noise Cancelling earbuds with Smart Charging Case',
#     price: 551.21
#   },
#   {
#     itemTitle: 'Soundcore Space Oneæ— çº¿è€³æœº40H ANCæ’­æ”¾æ—¶é—´2XStrongerè¯­éŸ³è¿˜åŸ',
#     price: 543.94
#   }
# ]
```

## ç¬¬å››æ­¥ï¼šæŸ¥çœ‹è¿è¡ŒæŠ¥å‘Š

å½“ä¸Šé¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºï¼š`Midscene - report file updated: /path/to/report/some_id.html`ï¼Œ é€šè¿‡æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶å³å¯çœ‹åˆ°æŠ¥å‘Šã€‚

## æ›´å¤š

* æ›´å¤š Agent ä¸Šçš„ API æ¥å£è¯·å‚è€ƒ [API å‚è€ƒ](./API)ã€‚
* æ›´å¤šå…³äºæç¤ºè¯çš„æŠ€å·§è¯·å‚è€ƒ [æç¤ºè¯æŠ€å·§](./prompting-tips)
