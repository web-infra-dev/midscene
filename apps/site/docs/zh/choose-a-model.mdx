import TroubleshootingLLMConnectivity from './common/troubleshooting-llm-connectivity.mdx';

# 选择 AI 模型

选择以下模型之一，获取 API 密钥，完成配置，即可开始使用 Midscene.js。如果你是初学者，请选择最容易获得的模型。

## Midscene.js 已适配的模型

Midscene.js 支持两种类型的模型：

### LLM 模型

能够理解文本和图像输入的模型。GPT-4o 就是这种类型的模型。

LLM 模型只能在 Web 自动化中使用。

* [`GPT-4o`](#gpt-4o)
* [其他 LLM 模型](#其他-llm-模型)

### 视觉语言模型（VL 模型，✨ 推荐）

除了能够理解文本和图像输入外，VL（Visual-Language，视觉语言）模型还可以定位页面上目标元素的坐标。

我们推荐在 UI 自动化中使用 VL 模型，因为它们可以原生地"看到"截图并返回页面上目标元素的坐标，在复杂场景中更加可靠和高效。

VL 模型可用于任何类型界面的 UI 自动化。

以下是已适配的 VL 模型：

* [豆包系列视觉语言模型](#doubao-vision)
* [千问3-VL或千问2.5-VL](#qwen3-vl-or-qwen-25-vl)
* [`Gemini-2.5-Pro`](#gemini-25-pro)
* [`UI-TARS`](#ui-tars)

如果你想了解模型服务的详细配置，请参见[配置模型和服务商](./model-provider)。

## 深入了解模型

<div id="gpt-4o"></div>
### `GPT-4o`

GPT-4o 是 OpenAI 的多模态 LLM，支持图像输入。这是 Midscene.js 的默认模型。使用 GPT-4o 时，建议使用逐步提示。

由于 Midscene 需要向模型发送一些 DOM 信息和截图，使用 GPT-4o 的 token 成本较高，并且在复杂场景中不够稳定。

**配置**

```bash
OPENAI_API_KEY="......"
OPENAI_BASE_URL="https://custom-endpoint.com/compatible-mode/v1" # 可选，如果你想要使用不同于 OpenAI 默认的接入点
MIDSCENE_MODEL_NAME="gpt-4o-2024-11-20" # 可选，默认是 "gpt-4o"
```


<div id="doubao-vision"></div>

### 豆包系列视觉语言模型（✨ 推荐）

火山引擎提供了多个视觉语言模型，包括：
* `Doubao-1.5-thinking-vision-pro`
* `Doubao-seed-1.6-vision`

它们在复杂场景的视觉定位和断言方面表现相当出色。在指令清晰的情况下，能满足绝大多数业务场景需求，是目前 Midscene 最推荐的视觉语言模型。

**配置**

从 [火山引擎](https://volcengine.com) 获取 API 密钥后，可以使用以下配置：

```bash
OPENAI_BASE_URL="https://ark.cn-beijing.volces.com/api/v3" 
OPENAI_API_KEY="...."
MIDSCENE_MODEL_NAME="ep-..." # 来自火山引擎的推理接入点 ID 或模型名称
MIDSCENE_USE_DOUBAO_VISION=1
```

**链接**
- [火山引擎 - Doubao-1.5-thinking-vision-pro](https://www.volcengine.com/docs/82379/1536428)
- [火山引擎 - Doubao-Seed-1.6-Vision](https://www.volcengine.com/docs/82379/1799865)


<div id="qwen3-vl-or-qwen-25-vl"></div>
### 千问3-VL或千问2.5-VL （Openrouter 或阿里云）

从 0.29.1 版本开始，Midscene.js 支持 Qwen3-VL 模型系列。

Qwen-VL 是阿里巴巴发布的开源模型系列。它提供视觉定位能力，可以准确返回页面上目标元素的坐标。在用于交互、断言和查询时表现相当出色。使用千问系列模型时，我们建议使用最新的 Qwen3-VL 模型。

**使用阿里云 `qwen3-vl-plus` 模型的配置**

```bash
OPENAI_BASE_URL="https://dashscope.aliyuncs.com/compatible-mode/v1"
OPENAI_API_KEY="......"
MIDSCENE_MODEL_NAME="qwen3-vl-plus"
MIDSCENE_USE_QWEN3_VL=1 # 注意，这个参数与 MIDSCENE_USE_QWEN_VL 不能同时使用
```

**使用阿里云 `qwen-vl-max-latest` 模型的配置**

```bash
OPENAI_BASE_URL="https://dashscope.aliyuncs.com/compatible-mode/v1"
OPENAI_API_KEY="......"
MIDSCENE_MODEL_NAME="qwen-vl-max-latest"
MIDSCENE_USE_QWEN_VL=1 # 注意，这个参数与 MIDSCENE_USE_QWEN3_VL 不能同时使用
```

**使用 Openrouter `qwen-vl-max-latest` 模型的配置**

在 [Openrouter](https://openrouter.ai) 上申请 API 密钥后，可以使用以下配置：

```bash
OPENAI_BASE_URL="https://openrouter.ai/api/v1"
OPENAI_API_KEY="......"
MIDSCENE_MODEL_NAME="qwen/qwen2.5-vl-72b-instruct"
MIDSCENE_USE_QWEN_VL=1 # 注意，这个参数与 MIDSCENE_USE_QWEN3_VL 不能同时使用
```

**链接**
- [Qwen on 🤗 HuggingFace](https://huggingface.co/Qwen)
- [Qwen on Github](https://github.com/QwenLM/)
- [Qwen 2.5 on Aliyun](https://bailian.console.aliyun.com/#/model-market/detail/qwen-vl-max-latest)
- [Qwen 2.5 on openrouter.ai](https://openrouter.ai/qwen/qwen2.5-vl-72b-instruct)

<div id="gemini-25-pro"></div>
### `Gemini-2.5-Pro` （Google Gemini）

从 0.15.1 版本开始，Midscene.js 支持 Gemini-2.5-Pro 模型。Gemini 2.5 Pro 是 Google Cloud 提供的闭源模型。

使用 Gemini-2.5-Pro 时，你应该使用 `MIDSCENE_USE_GEMINI=1` 配置来开启 Gemini-2.5-Pro 模式。

**配置**

在 [Google Gemini](https://gemini.google.com/) 上申请 API 密钥后，可以使用以下配置：

```bash
OPENAI_BASE_URL="https://generativelanguage.googleapis.com/v1beta/openai/"
OPENAI_API_KEY="......"
MIDSCENE_MODEL_NAME="gemini-2.5-pro-preview-05-06"
MIDSCENE_USE_GEMINI=1
```

**链接**
- [Gemini 2.5 on Google Cloud](https://cloud.google.com/gemini-api/docs/gemini-25-overview)

<div id="ui-tars"></div>

### `UI-TARS` （火山引擎）

UI-TARS 是基于 VLM 架构的端到端 GUI 代理模型。它仅感知截图作为输入，并执行类似人类的交互（例如键盘和鼠标操作），在 10 多个 GUI 基准测试中实现了最先进的性能。UI-TARS 是一个开源模型，并提供不同大小的版本。

使用 UI-TARS 时，你可以使用目标驱动风格的提示，如"使用用户名 foo 和密码 bar 登录"，它会规划步骤来实现目标。

**配置**

你可以在 [火山引擎](https://volcengine.com) 上使用部署的 `doubao-1.5-ui-tars`。

```bash
OPENAI_BASE_URL="https://ark.cn-beijing.volces.com/api/v3" 
OPENAI_API_KEY="...."
MIDSCENE_MODEL_NAME="ep-2025..." # 来自火山引擎的推理接入点 ID 或模型名称
MIDSCENE_USE_VLM_UI_TARS=DOUBAO
```

**限制**

- **断言表现不佳**：它在断言和查询方面可能不如 GPT-4o 和 Qwen 2.5。
- **操作路径不稳定**：它可能会尝试不同的路径来实现目标，因此每次调用的操作路径不稳定。

**关于 `MIDSCENE_USE_VLM_UI_TARS` 配置**

`MIDSCENE_USE_VLM_UI_TARS` 配置用于指定 UI-TARS 版本，使用以下值之一：
- `1.0` - 用于模型版本 `1.0`
- `1.5` - 用于模型版本 `1.5`
- `DOUBAO` - 用于在火山引擎上部署的模型

**链接**
- [UI-TARS on 🤗 HuggingFace](https://huggingface.co/bytedance-research/UI-TARS-72B-SFT)
- [UI-TARS on Github](https://github.com/bytedance/ui-tars)
- [UI-TARS - Model Deployment Guide](https://juniper-switch-f10.notion.site/UI-TARS-Model-Deployment-Guide-17b5350241e280058e98cea60317de71)
- [UI-TARS on Volcengine](https://www.volcengine.com/docs/82379/1536429)


<div id="其他-llm-模型"></div>
## 选择其他多模态 LLM

Midscene.js 也支持其他模型。对于这些模型，Midscene 将使用与 GPT-4o 相同的提示和策略。如果你想使用其他模型，请按照以下步骤操作：

1. 需要多模态模型，这意味着它必须支持图像输入。
1. 模型越大，效果越好。但是，它需要更多的 GPU 或资金。
1. 找出如何使用与 OpenAI SDK 兼容的接入点调用它。通常你应该设置 `OPENAI_BASE_URL`、`OPENAI_API_KEY` 和 `MIDSCENE_MODEL_NAME`。配置说明请参见[配置模型和服务商](./model-provider)。
1. 如果在更换模型后发现效果不佳，可以尝试使用一些简短清晰的提示，或者回滚到之前的模型。更多详情请参见[提示技巧](./prompting-tips)。
1. 请记住遵守每个模型和服务商的使用条款。
1. 除非你知道自己在做什么，否则不要包含 `MIDSCENE_USE_VLM_UI_TARS` 和 `MIDSCENE_USE_QWEN_VL` 配置。

**配置**

```bash
MIDSCENE_MODEL_NAME="....."
OPENAI_BASE_URL="......"
OPENAI_API_KEY="......"
```

更多详细信息和示例配置，请参见[配置模型和服务商](./model-provider)。

## 常见问题

### 如何查看模型的 token 使用情况？

通过在环境变量中设置 `DEBUG=midscene:ai:profile:stats`，你可以打印模型的使用信息和响应时间。

你也可以在报告文件中查看模型的使用信息。

### 收到了 "No visual language model (VL model) detected" 错误

请确保你正确配置了 VL 模型，特别是 `MIDSCENE_USE_...` 配置是否正确。

## 更多信息

* [配置模型和服务商](./model-provider)
* [编写提示词（指令）的技巧](./prompting-tips)

<TroubleshootingLLMConnectivity />