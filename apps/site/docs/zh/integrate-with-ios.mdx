import SetupEnv from './common/setup-env.mdx';

# ä¸ iOS(WebDriverAgent) é›†æˆ

åœ¨ä½¿ç”¨ WebDriverAgent è¿æ¥ iOS è®¾å¤‡åï¼Œä½ å¯ä»¥ä½¿ç”¨ Midscene javascript SDK æ¥æ§åˆ¶ iOS è®¾å¤‡ã€‚

import { PackageManagerTabs } from '@theme';

:::info æ ·ä¾‹é¡¹ç›®
ä½¿ç”¨ javascript SDK æ§åˆ¶ iOS è®¾å¤‡ï¼š[https://github.com/web-infra-dev/midscene-example/blob/main/ios/javascript-sdk-demo](https://github.com/web-infra-dev/midscene-example/blob/main/ios/javascript-sdk-demo)

ä¸ Vitest é›†æˆå’Œæµ‹è¯•ï¼š[https://github.com/web-infra-dev/midscene-example/tree/main/ios/vitest-demo](https://github.com/web-infra-dev/midscene-example/tree/main/ios/vitest-demo)
:::


:::info æ¡ˆä¾‹å±•ç¤º

[æŸ¥çœ‹æ›´å¤šæ¡ˆä¾‹](./blog-support-android-automation.mdx)

<p align="center">
  <img src="/ios.png" alt="ios" width="400" />
</p>

:::

## å…³äº WebDriver å’Œ Midscene çš„å…³ç³»

WebDriver æ˜¯ä¸€å¥—ç”± W3C åˆ¶å®šçš„ç”¨äºæµè§ˆå™¨è‡ªåŠ¨åŒ–çš„æ ‡å‡†åè®®ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„ API æ¥æ§åˆ¶ä¸åŒçš„æµè§ˆå™¨å’Œåº”ç”¨ç¨‹åºã€‚WebDriver åè®®å®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ï¼Œä½¿å¾—è‡ªåŠ¨åŒ–å·¥å…·èƒ½å¤Ÿè·¨å¹³å°åœ°æ§åˆ¶å„ç§ç”¨æˆ·ç•Œé¢ã€‚

åœ¨ Appium å›¢é˜ŸåŠå…¶ä»–å¼€æºç¤¾åŒºçš„åŠªåŠ›ä¸‹ï¼Œä¸šç•Œå·²ç»æœ‰äº†è®¸å¤šä¼˜ç§€çš„åº“å°†æ¡Œé¢ã€ç§»åŠ¨ç«¯ç­‰è®¾å¤‡çš„è‡ªåŠ¨åŒ–æ“ä½œè½¬åŒ–ä¸º WebDriver åè®®ã€‚è¿™äº›å·¥å…·åŒ…æ‹¬ï¼š
- **Appium** - è·¨å¹³å°ç§»åŠ¨è‡ªåŠ¨åŒ–æ¡†æ¶
- **WebDriverAgent** - ä¸“é—¨ç”¨äº iOS è®¾å¤‡è‡ªåŠ¨åŒ–çš„æœåŠ¡
- **Selenium** - Web æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·
- **WinAppDriver** - Windows åº”ç”¨ç¨‹åºè‡ªåŠ¨åŒ–å·¥å…·

**Midscene é€‚é…äº† WebDriver åè®®**ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥ä½¿ç”¨ AI æ¨¡å‹å¯¹æ”¯æŒ WebDriver çš„ä»»ä½•è®¾å¤‡è¿›è¡Œæ™ºèƒ½åŒ–çš„è‡ªåŠ¨åŒ–æ“ä½œã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼ŒMidscene ä¸ä»…èƒ½å¤Ÿæ§åˆ¶ä¼ ç»Ÿçš„ç‚¹å‡»ã€è¾“å…¥ç­‰åŸºç¡€æ“ä½œï¼Œè¿˜èƒ½å¤Ÿï¼š
- ç†è§£ç•Œé¢å†…å®¹å’Œä¸Šä¸‹æ–‡
- æ‰§è¡Œå¤æ‚çš„å¤šæ­¥éª¤æ“ä½œ
- è¿›è¡Œæ™ºèƒ½æ–­è¨€å’ŒéªŒè¯
- æå–å’Œåˆ†æç•Œé¢æ•°æ®

åœ¨ iOS å¹³å°ä¸Šï¼ŒMidscene é€šè¿‡ WebDriverAgent è¿æ¥ iOS è®¾å¤‡ï¼Œè®©ä½ èƒ½å¤Ÿä½¿ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æ–¹å¼æ¥æ§åˆ¶ iOS åº”ç”¨å’Œç³»ç»Ÿã€‚

## å‡†å¤‡ WebDriver æœåŠ¡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆè®¾ç½® iOS å¼€å‘ç¯å¢ƒï¼š

- macOSï¼ˆiOS å¼€å‘å¿…éœ€ï¼‰
- Xcode å’Œ Xcode å‘½ä»¤è¡Œå·¥å…·
- iOS æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºè®¾å¤‡

### é…ç½®ç¯å¢ƒ

åœ¨ä½¿ç”¨ Midscene iOS ä¹‹å‰ï¼Œéœ€è¦å…ˆå‡†å¤‡ WebDriverAgent æœåŠ¡ã€‚è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£è¿›è¡Œè®¾ç½®ï¼š

- **æ¨¡æ‹Ÿå™¨é…ç½®**ï¼š[Run Prebuilt WDA](https://appium.github.io/appium-xcuitest-driver/5.12/run-prebuilt-wda/)
- **çœŸæœºé…ç½®**ï¼š[Real Device Configuration](https://appium.github.io/appium-xcuitest-driver/5.12/real-device-config/)

### éªŒè¯ç¯å¢ƒé…ç½®

é…ç½®å®Œæˆåï¼Œå¯ä»¥é€šè¿‡è®¿é—® WebDriverAgent çš„çŠ¶æ€æ¥å£æ¥éªŒè¯ æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š

**è®¿é—®åœ°å€**ï¼š`http://localhost:8100/status`

**æ­£ç¡®å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "value": {
    "build": {
      "version": "10.1.1",
      "time": "Sep 24 2025 18:56:41",
      "productBundleIdentifier": "com.facebook.WebDriverAgentRunner"
    },
    "os": {
      "testmanagerdVersion": 65535,
      "name": "iOS",
      "sdkVersion": "26.0",
      "version": "26.0"
    },
    "device": "iphone",
    "ios": {
      "ip": "10.91.115.63"
    },
    "message": "WebDriverAgent is ready to accept commands",
    "state": "success",
    "ready": true
  },
  "sessionId": "BCAD9603-F714-447C-A9E6-07D58267966B"
}
```

å¦‚æœèƒ½å¤Ÿæ­£å¸¸è®¿é—®è¯¥ç«¯ç‚¹å¹¶è¿”å›ç±»ä¼¼ä¸Šè¿°çš„ JSON å“åº”ï¼Œè¯´æ˜ WebDriverAgent å·²ç»æ­£ç¡®é…ç½®å¹¶è¿è¡Œã€‚

<SetupEnv />

## é›†æˆ Midscene

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–

<PackageManagerTabs command="install @midscene/ios --save-dev" />

### ç¬¬äºŒæ­¥ï¼šç¼–å†™è„šæœ¬

è¿™é‡Œä»¥ä½¿ç”¨ iOS Safari æµè§ˆå™¨æœç´¢è€³æœºä¸ºä¾‹ã€‚

ç¼–å†™ä¸‹æ–¹ä»£ç ï¼Œä¿å­˜ä¸º `./demo.ts`

```typescript title="./demo.ts"
import {
  IOSAgent,
  IOSDevice,
  agentFromWebDriverAgent,
} from '@midscene/ios';

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));
Promise.resolve(
  (async () => {
    // æ–¹æ³•ä¸€ï¼šç›´æ¥åˆ›å»ºè®¾å¤‡å’Œä»£ç†
    const page = new IOSDevice({
      wdaPort: 8100,
      wdaHost: 'localhost',
    });

    // ğŸ‘€ åˆå§‹åŒ– Midscene agent
    const agent = new IOSAgent(page, {
      aiActionContext:
        'å¦‚æœå‡ºç°ä½ç½®ã€æƒé™ã€ç”¨æˆ·åè®®ç­‰å¼¹çª—ï¼Œç‚¹å‡»åŒæ„ã€‚å¦‚æœå‡ºç°ç™»å½•é¡µé¢ï¼Œå…³é—­å®ƒã€‚',
    });
    await page.connect();

    // æ–¹æ³•äºŒï¼šæˆ–è€…ä½¿ç”¨ä¾¿æ·å‡½æ•°ï¼ˆæ¨èï¼‰
    // const agent = await agentFromWebDriverAgent({
    //   wdaPort: 8100,
    //   wdaHost: 'localhost',
    //   aiActionContext: 'å¦‚æœå‡ºç°ä½ç½®ã€æƒé™ã€ç”¨æˆ·åè®®ç­‰å¼¹çª—ï¼Œç‚¹å‡»åŒæ„ã€‚å¦‚æœå‡ºç°ç™»å½•é¡µé¢ï¼Œå…³é—­å®ƒã€‚',
    // });

    // ğŸ‘€ æ‰“å¼€ ebay.com ç½‘é¡µ
    await page.launch('https://ebay.com');
    await sleep(3000);

    // ğŸ‘€ è¾“å…¥å…³é”®è¯ï¼Œæ‰§è¡Œæœç´¢
    await agent.aiAction('åœ¨æœç´¢æ¡†è¾“å…¥ "Headphones" ï¼Œæ•²å›è½¦');

    // ğŸ‘€ ç­‰å¾…åŠ è½½å®Œæˆ
    await agent.aiWaitFor('é¡µé¢ä¸­è‡³å°‘æœ‰ä¸€ä¸ªè€³æœºå•†å“');
    // æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„ sleep:
    // await sleep(5000);

    // ğŸ‘€ ç†è§£é¡µé¢å†…å®¹ï¼Œæå–æ•°æ®
    const items = await agent.aiQuery(
      '{itemTitle: string, price: Number}[], æ‰¾åˆ°åˆ—è¡¨é‡Œçš„å•†å“æ ‡é¢˜å’Œä»·æ ¼',
    );
    console.log('è€³æœºå•†å“ä¿¡æ¯', items);

    // ğŸ‘€ ç”¨ AI æ–­è¨€
    await agent.aiAssert('ç•Œé¢ä¸­æœ‰å¤šä¸ªè€³æœºäº§å“');

    await page.destroy();
  })(),
);
```

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œ

ä½¿ç”¨ `tsx` æ¥è¿è¡Œ

```bash
# run
npx tsx demo.ts
```

ç¨ç­‰ç‰‡åˆ»ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š

```log
[
 {
   itemTitle: 'AirPods Pro (2nd generation) with MagSafe Charging Case (USB-C)',
   price: 249
 },
 {
   itemTitle: 'Sony WH-1000XM4 Wireless Premium Noise Canceling Overhead Headphones',
   price: 278
 }
]
```

### ç¬¬å››æ­¥ï¼šæŸ¥çœ‹è¿è¡ŒæŠ¥å‘Š

å½“ä¸Šé¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºï¼š`Midscene - report file updated: /path/to/report/some_id.html`ï¼Œ é€šè¿‡æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶å³å¯çœ‹åˆ°æŠ¥å‘Šã€‚

## æ„é€ å‡½æ•°ä¸æ¥å£

### `IOSDevice` çš„æ„é€ å‡½æ•°

IOSDevice çš„æ„é€ å‡½æ•°æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š

- `opts?: IOSDeviceOpt` - å¯é€‰å‚æ•°ï¼Œç”¨äºåˆå§‹åŒ– IOSDevice çš„é…ç½®
  - `wdaPort?: number` - å¯é€‰å‚æ•°ï¼ŒWebDriverAgent ç«¯å£ã€‚é»˜è®¤å€¼ä¸º 8100ã€‚
  - `wdaHost?: string` - å¯é€‰å‚æ•°ï¼ŒWebDriverAgent ä¸»æœºã€‚é»˜è®¤å€¼ä¸º 'localhost'ã€‚
  - `autoDismissKeyboard?: boolean` - å¯é€‰å‚æ•°ï¼Œæ˜¯å¦åœ¨è¾“å…¥æ–‡æœ¬åè‡ªåŠ¨å…³é—­é”®ç›˜ã€‚é»˜è®¤å€¼ä¸º trueã€‚
  - `customActions?: DeviceAction<any>[]` - å¯é€‰å‚æ•°ï¼Œè‡ªå®šä¹‰è®¾å¤‡åŠ¨ä½œåˆ—è¡¨ã€‚

### iOS Agent ä¸Šçš„æ›´å¤šæ¥å£

é™¤äº† [API å‚è€ƒ](./api.mdx) ä¸­çš„é€šç”¨ Agent æ¥å£ï¼ŒIOSAgent è¿˜æä¾›äº†ä¸€äº›å…¶ä»–æ¥å£ï¼š

#### `agent.launch()`

å¯åŠ¨ä¸€ä¸ªç½‘é¡µæˆ–åŸç”Ÿ iOS åº”ç”¨ã€‚

- ç±»å‹

```typescript
function launch(uri: string): Promise<void>;
```

- å‚æ•°ï¼š

  - `uri: string` - è¦æ‰“å¼€çš„ uriï¼Œå¯ä»¥æ˜¯ç½‘é¡µ urlã€åŸç”Ÿ app çš„ bundle identifier æˆ–è‡ªå®šä¹‰ URL scheme

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
import { IOSAgent, IOSDevice, agentFromWebDriverAgent } from '@midscene/ios';

// æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨åˆ›å»ºè®¾å¤‡å’Œä»£ç†
const page = new IOSDevice();
const agent = new IOSAgent(page);
await page.connect();

// æ–¹æ³•äºŒï¼šä½¿ç”¨ä¾¿æ·å‡½æ•°ï¼ˆæ¨èï¼‰
const agent = await agentFromWebDriverAgent();

await agent.launch('https://www.apple.com'); // æ‰“å¼€ç½‘é¡µ
await agent.launch('com.apple.mobilesafari'); // å¯åŠ¨ Safari
await agent.launch('com.apple.Preferences'); // å¯åŠ¨è®¾ç½®åº”ç”¨
await agent.launch('myapp://profile/user/123'); // æ‰“å¼€åº”ç”¨æ·±åº¦é“¾æ¥
await agent.launch('tel:+1234567890'); // æ‹¨æ‰“ç”µè¯
await agent.launch('mailto:example@email.com'); // å‘é€é‚®ä»¶
```

#### `agentFromWebDriverAgent()` (æ¨è)

é€šè¿‡è¿æ¥ WebDriverAgent æœåŠ¡åˆ›å»º IOSAgentï¼Œè¿™æ˜¯æœ€ç®€ä¾¿çš„æ–¹å¼ã€‚

- ç±»å‹

```typescript
function agentFromWebDriverAgent(
  opts?: PageAgentOpt & IOSDeviceOpt,
): Promise<IOSAgent>;
```

- å‚æ•°ï¼š

  - `opts?: PageAgentOpt & IOSDeviceOpt` - å¯é€‰å‚æ•°ï¼Œç”¨äºåˆå§‹åŒ– IOSAgent çš„é…ç½®ï¼Œå…¶ä¸­ PageAgentOpt å‚è€ƒ [æ„é€ å™¨](./api.mdx)ï¼ŒIOSDeviceOpt çš„é…ç½®å€¼å‚è€ƒ [IOSDevice çš„æ„é€ å‡½æ•°](./integrate-with-ios#iosdevice-%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0)

- è¿”å›å€¼ï¼š

  - `Promise<IOSAgent>` è¿”å›ä¸€ä¸ª IOSAgent å®ä¾‹

- ç¤ºä¾‹ï¼š

```typescript
import { agentFromWebDriverAgent } from '@midscene/ios';

// ä½¿ç”¨é»˜è®¤ WebDriverAgent åœ°å€ (localhost:8100)
const agent = await agentFromWebDriverAgent();

// ä½¿ç”¨è‡ªå®šä¹‰ WebDriverAgent åœ°å€
const agent = await agentFromWebDriverAgent({
  wdaHost: 'localhost',
  wdaPort: 8100,
  aiActionContext: 'å¦‚æœå‡ºç°å¼¹çª—ï¼Œç‚¹å‡»åŒæ„',
});
```



## æ‰©å±•è‡ªå®šä¹‰äº¤äº’åŠ¨ä½œ

ä½¿ç”¨ `customActions` é€‰é¡¹ï¼Œç»“åˆ `defineAction` å®šä¹‰çš„è‡ªå®šä¹‰äº¤äº’åŠ¨ä½œï¼Œå¯ä»¥æ‰©å±• Agent çš„åŠ¨ä½œç©ºé—´ã€‚è¿™äº›åŠ¨ä½œä¼šè¿½åŠ åœ¨å†…ç½®åŠ¨ä½œä¹‹åï¼Œæ–¹ä¾¿ Agent åœ¨è§„åˆ’é˜¶æ®µè°ƒç”¨ã€‚

```typescript
import { getMidsceneLocationSchema, z } from '@midscene/core';
import { defineAction } from '@midscene/core/device';
import { IOSAgent, IOSDevice } from '@midscene/ios';

const ContinuousClick = defineAction({
  name: 'continuousClick',
  description: 'Click the same target repeatedly',
  paramSchema: z.object({
    locate: getMidsceneLocationSchema(),
    count: z
      .number()
      .int()
      .positive()
      .describe('How many times to click'),
  }),
  async call(param) {
    const { locate, count } = param;
    console.log('click target center', locate.center);
    console.log('click count', count);
    // åœ¨è¿™é‡Œç»“åˆ locate + count å®ç°è‡ªå®šä¹‰ç‚¹å‡»é€»è¾‘
  },
});

const agent = await agentFromWebDriverAgent({
  customActions: [ContinuousClick],
});

await agent.aiAction('ç‚¹å‡»çº¢è‰²æŒ‰é’®äº”æ¬¡');
```

æ›´å¤šå…³äºè‡ªå®šä¹‰åŠ¨ä½œçš„ç»†èŠ‚ï¼Œè¯·å‚è€ƒ [é›†æˆåˆ°ä»»æ„ç•Œé¢](./integrate-with-any-interface)ã€‚

## æ›´å¤š

- æ›´å¤š Agent ä¸Šçš„ API æ¥å£è¯·å‚è€ƒ [API å‚è€ƒ](./api.mdx)ã€‚
- æ›´å¤šå…³äºæç¤ºè¯çš„æŠ€å·§è¯·å‚è€ƒ [æç¤ºè¯æŠ€å·§](./prompting-tips)

## FAQ

### ä¸ºä»€ä¹ˆæˆ‘è¿æ¥äº†è®¾å¤‡ï¼Œä½†æ˜¯é€šè¿‡ WebDriverAgent ä»ç„¶æ— æ³•æ§åˆ¶ï¼Ÿ

è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **å¼€å‘è€…æ¨¡å¼**ï¼šç¡®ä¿åœ¨è®¾ç½® > éšç§ä¸å®‰å…¨æ€§ > å¼€å‘è€…æ¨¡å¼ ä¸­å·²å¼€å¯
2. **UI è‡ªåŠ¨åŒ–**ï¼šç¡®ä¿åœ¨è®¾ç½® > å¼€å‘è€… > UI è‡ªåŠ¨åŒ–ï¼Œå¯ç”¨ UI è‡ªåŠ¨åŒ–
3. **è®¾å¤‡ä¿¡ä»»**ï¼šç¡®ä¿è®¾å¤‡å·²ä¿¡ä»»å½“å‰ Mac

### æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

| ç‰¹æ€§ | çœŸæœº | æ¨¡æ‹Ÿå™¨ |
|------|------|---------|
| ç«¯å£è½¬å‘ | éœ€è¦ iproxy | ä¸éœ€è¦ |
| å¼€å‘è€…æ¨¡å¼ | éœ€è¦å¯ç”¨ | è‡ªåŠ¨å¯ç”¨ |
| UI è‡ªåŠ¨åŒ–è®¾ç½® | éœ€è¦æ‰‹åŠ¨å¯ç”¨ | è‡ªåŠ¨å¯ç”¨ |
| æ€§èƒ½ | çœŸå®è®¾å¤‡æ€§èƒ½ | ä¾èµ– Mac æ€§èƒ½ |
| ä¼ æ„Ÿå™¨ | çœŸå®ç¡¬ä»¶ | æ¨¡æ‹Ÿæ•°æ® |

### å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰çš„ WebDriverAgent ç«¯å£å’Œä¸»æœºï¼Ÿ

ä½ å¯ä»¥é€šè¿‡ IOSDevice çš„æ„é€ å‡½æ•°æˆ– agentFromWebDriverAgent æ¥æŒ‡å®š WebDriverAgent çš„ç«¯å£å’Œä¸»æœºï¼š

```typescript
// æ–¹æ³•ä¸€ï¼šä½¿ç”¨ IOSDevice
const device = new IOSDevice({
  wdaPort: 8100,        // è‡ªå®šä¹‰ç«¯å£
  wdaHost: '192.168.1.100', // è‡ªå®šä¹‰ä¸»æœº
});

// æ–¹æ³•äºŒï¼šä½¿ç”¨ä¾¿æ·å‡½æ•°ï¼ˆæ¨èï¼‰
const agent = await agentFromWebDriverAgent({
  wdaPort: 8100,        // è‡ªå®šä¹‰ç«¯å£
  wdaHost: '192.168.1.100', // è‡ªå®šä¹‰ä¸»æœº
});
```

å¯¹äºè¿œç¨‹è®¾å¤‡ï¼Œè¿˜éœ€è¦ç›¸åº”åœ°è®¾ç½®ç«¯å£è½¬å‘ï¼š

```bash
iproxy 8100 8100 YOUR_DEVICE_ID
```