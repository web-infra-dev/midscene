# API å‚è€ƒ

> åœ¨ä»¥ä¸‹æ–‡æ¡£ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°å¸¦æœ‰ `agent.` å‰ç¼€çš„å‡½æ•°è°ƒç”¨ã€‚å¦‚æœä½ åœ¨ Playwright ä¸­ï¼Œè¿™äº›è°ƒç”¨æ˜¯ä¸å¸¦ `agent.` å‰ç¼€çš„ï¼Œå¦‚ `async ({ ai, aiQuery }) => { /* ... */}`ã€‚è¿™åªæ˜¯è§£æ„è¯­æ³•çš„åŒºåˆ«ã€‚

## æ„é€ å™¨

Midscene ä¸­æ¯ä¸ª Agent éƒ½æœ‰è‡ªå·±çš„æ„é€ å‡½æ•°ã€‚

- åœ¨ Puppeteer ä¸­ï¼Œä½¿ç”¨ [PuppeteerAgent](./integrate-with-puppeteer)
- åœ¨æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Modeï¼‰ä¸­ï¼Œä½¿ç”¨ [AgentOverChromeBridge](./bridge-mode-by-chrome-extension#constructor)
- åœ¨ Android ä¸­ï¼Œä½¿ç”¨ [AndroidAgent](./integrate-with-android)

è¿™äº› Agent æœ‰ä¸€äº›ç›¸åŒçš„æ„é€ å‚æ•°ï¼š

- `generateReport: boolean`: å¦‚æœä¸º trueï¼Œåˆ™ç”ŸæˆæŠ¥å‘Šæ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸º trueã€‚
- `autoPrintReportMsg: boolean`: å¦‚æœä¸º trueï¼Œåˆ™æ‰“å°æŠ¥å‘Šæ¶ˆæ¯ã€‚é»˜è®¤å€¼ä¸º trueã€‚
- `cacheId: string | undefined`: å¦‚æœé…ç½®ï¼Œåˆ™ä½¿ç”¨æ­¤ cacheId ä¿å­˜æˆ–åŒ¹é…ç¼“å­˜ã€‚é»˜è®¤å€¼ä¸º undefinedï¼Œä¹Ÿå°±æ˜¯ä¸å¯ç”¨ç¼“å­˜ã€‚
- `actionContext: string`: è°ƒç”¨ `agent.aiAction()` æ—¶ï¼Œå‘é€ç»™ AI æ¨¡å‹çš„èƒŒæ™¯çŸ¥è¯†ï¼Œæ¯”å¦‚ 'æœ‰ cookie å¯¹è¯æ¡†æ—¶å…ˆå…³é—­å®ƒ'ï¼Œé»˜è®¤å€¼ä¸ºç©ºã€‚

åœ¨ Playwright å’Œ Puppeteer ä¸­ï¼Œæœ‰ä»¥ä¸‹å…±åŒçš„å‚æ•°ï¼š

- `forceSameTabNavigation: boolean`: å¦‚æœä¸º trueï¼Œåˆ™é™åˆ¶é¡µé¢åœ¨å½“å‰ tab æ‰“å¼€ã€‚é»˜è®¤å€¼ä¸º trueã€‚
- `waitForNetworkIdleTimeout: number`: åœ¨æ‰§è¡Œæ¯ä¸ªæ“ä½œåç­‰å¾…ç½‘ç»œç©ºé—²çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 2000msï¼Œè®¾ç½®ä¸º 0 åˆ™ä¸åšç­‰å¾…ã€‚
- `waitForNavigationTimeout: number`: åœ¨é¡µé¢è·³è½¬åç­‰å¾…é¡µé¢åŠ è½½å®Œæˆçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 5000msï¼Œè®¾ç½®ä¸º 0 åˆ™ä¸åšç­‰å¾…ã€‚

## äº¤äº’æ–¹æ³•

è¿™äº›æ˜¯ Midscene ä¸­å„ç±» Agent çš„ä¸»è¦ APIã€‚

:::info è‡ªåŠ¨è§„åˆ’ v.s. å³æ—¶æ“ä½œ

åœ¨ Midscene ä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨è‡ªåŠ¨è§„åˆ’ï¼ˆAuto Planningï¼‰æˆ–å³æ—¶æ“ä½œï¼ˆInstant Actionï¼‰ã€‚

- `agent.ai()` æ˜¯è‡ªåŠ¨è§„åˆ’ï¼ˆAuto Planningï¼‰ï¼šMidscene ä¼šè‡ªåŠ¨è§„åˆ’æ“ä½œæ­¥éª¤å¹¶æ‰§è¡Œã€‚å®ƒæ›´æ™ºèƒ½ï¼Œæ›´åƒæµè¡Œçš„ AI Agent é£æ ¼ï¼Œä½†å¯èƒ½è¾ƒæ…¢ï¼Œä¸”æ•ˆæœä¾èµ–äº AI æ¨¡å‹çš„è´¨é‡ã€‚
- `agent.aiTap()`, `agent.aiHover()`, `agent.aiInput()`, `agent.aiKeyboardPress()`, `agent.aiScroll()`, `agent.aiRightClick()` æ˜¯å³æ—¶æ“ä½œï¼ˆInstant Actionï¼‰ï¼šMidscene ä¼šç›´æ¥æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œè€Œ AI æ¨¡å‹åªè´Ÿè´£åº•å±‚ä»»åŠ¡ï¼Œå¦‚å®šä½å…ƒç´ ç­‰ã€‚è¿™ç§æ¥å£å½¢å¼æ›´å¿«ã€æ›´å¯é ã€‚å½“ä½ å®Œå…¨ç¡®å®šè‡ªå·±æƒ³è¦æ‰§è¡Œçš„æ“ä½œæ—¶ï¼Œæ¨èä½¿ç”¨è¿™ç§æ¥å£å½¢å¼ã€‚

:::

### `agent.aiAction()` æˆ– `.ai()`

è¿™ä¸ªæ–¹æ³•å…è®¸ä½ é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°ä¸€ç³»åˆ— UI æ“ä½œæ­¥éª¤ã€‚Midscene ä¼šè‡ªåŠ¨è§„åˆ’è¿™äº›æ­¥éª¤å¹¶æ‰§è¡Œã€‚

- ç±»å‹

```typescript
function aiAction(
  prompt: string,
  opt?: {
    cacheable?: boolean;
  },
): Promise<void>;
function ai(prompt: string): Promise<void>; // ç®€å†™å½¢å¼
```

- å‚æ•°ï¼š

  - `prompt: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æ“ä½œå†…å®¹
  - `opt?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚å½“æ‰€æœ‰æ­¥éª¤æ‰§è¡Œå®Œæˆæ—¶è§£æä¸º voidï¼›è‹¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æŠ›å‡ºé”™è¯¯ã€‚

- ç¤ºä¾‹ï¼š

```typescript
// åŸºæœ¬ç”¨æ³•
await agent.aiAction('åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ "JavaScript"ï¼Œç„¶åç‚¹å‡»æœç´¢æŒ‰é’®');

// ä½¿ç”¨ .ai ç®€å†™å½¢å¼
await agent.ai(
  'ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„ç™»å½•æŒ‰é’®ï¼Œç„¶ååœ¨ç”¨æˆ·åè¾“å…¥æ¡†ä¸­è¾“å…¥ "test@example.com"',
);

// ä½¿ç”¨ ui-tars æ¨¡å‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ›´ç›®æ ‡é©±åŠ¨çš„æç¤ºè¯
await agent.aiAction('å‘å¸ƒä¸€æ¡å¾®åšï¼Œå†…å®¹ä¸º "Hello World"');
```

:::tip

åœ¨å®é™…è¿è¡Œæ—¶ï¼ŒMidscene ä¼šå°†ç”¨æˆ·æŒ‡ä»¤è§„åˆ’ï¼ˆPlanningï¼‰æˆå¤šä¸ªæ­¥éª¤ï¼Œç„¶åé€æ­¥æ‰§è¡Œã€‚å¦‚æœ Midscene è®¤ä¸ºæ— æ³•æ‰§è¡Œï¼Œå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

ä¸ºäº†è·å¾—æœ€ä½³æ•ˆæœï¼Œè¯·å°½å¯èƒ½æä¾›æ¸…æ™°ã€è¯¦ç»†çš„æ­¥éª¤æè¿°ã€‚å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡æ¡£ï¼š[ç¼–å†™æç¤ºè¯çš„æŠ€å·§](./prompting-tips)

å…³è”æ–‡æ¡£ï¼š

- [é€‰æ‹© AI æ¨¡å‹](./choose-a-model)

:::

### `agent.aiTap()`

ç‚¹å‡»æŸä¸ªå…ƒç´ ã€‚

- ç±»å‹

```typescript
function aiTap(locate: string, options?: Object): Promise<void>;
```

- å‚æ•°ï¼š
  - `locate: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„å…ƒç´ å®šä½ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `deepThink?: boolean` - æ˜¯å¦å¼€å¯æ·±åº¦æ€è€ƒã€‚å¦‚æœä¸º trueï¼ŒMidscene ä¼šè°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º False
    - `xpath?: string` - ç›®æ ‡å…ƒç´ çš„ xpath è·¯å¾„ï¼Œç”¨äºæ‰§è¡Œå½“å‰æ“ä½œã€‚å¦‚æœæä¾›äº†è¿™ä¸ª xpathï¼ŒMidscene ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ xpath æ¥æ‰¾åˆ°å…ƒç´ ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨ç¼“å­˜å’Œ AI æ¨¡å‹ã€‚é»˜è®¤å€¼ä¸ºç©º
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True
- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
await agent.aiTap('é¡µé¢é¡¶éƒ¨çš„ç™»å½•æŒ‰é’®');

// ä½¿ç”¨ deepThink åŠŸèƒ½ç²¾ç¡®å®šä½å…ƒç´ 
await agent.aiTap('é¡µé¢é¡¶éƒ¨çš„ç™»å½•æŒ‰é’®', { deepThink: true });
```

### `agent.aiHover()`

> ä»…åœ¨ web é¡µé¢ä¸­å¯ç”¨ï¼Œåœ¨ Android ä¸‹ä¸å¯ç”¨

é¼ æ ‡æ‚¬åœæŸä¸ªå…ƒç´ ä¸Šã€‚

- ç±»å‹

```typescript
function aiHover(locate: string, options?: Object): Promise<void>;
```

- å‚æ•°ï¼š
  - `locate: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„å…ƒç´ å®šä½ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `deepThink?: boolean` - æ˜¯å¦å¼€å¯æ·±åº¦æ€è€ƒã€‚å¦‚æœä¸º trueï¼ŒMidscene ä¼šè°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º False
    - `xpath?: string` - ç›®æ ‡å…ƒç´ çš„ xpath è·¯å¾„ï¼Œç”¨äºæ‰§è¡Œå½“å‰æ“ä½œã€‚å¦‚æœæä¾›äº†è¿™ä¸ª xpathï¼ŒMidscene ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ xpath æ¥æ‰¾åˆ°å…ƒç´ ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨ç¼“å­˜å’Œ AI æ¨¡å‹ã€‚é»˜è®¤å€¼ä¸ºç©º
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True
- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
await agent.aiHover('é¡µé¢é¡¶éƒ¨çš„ç™»å½•æŒ‰é’®');
```

### `agent.aiInput()`

åœ¨æŸä¸ªå…ƒç´ ä¸­è¾“å…¥æ–‡æœ¬ã€‚

- ç±»å‹

```typescript
function aiInput(text: string, locate: string, options?: Object): Promise<void>;
```

- å‚æ•°ï¼š

  - `text: string` - è¦è¾“å…¥çš„æ–‡æœ¬å†…å®¹ã€‚ä½¿ç”¨ç©ºå­—ç¬¦ä¸²å¯ä»¥æ¸…ç©ºè¾“å…¥æ¡†ã€‚
  - `locate: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„å…ƒç´ å®šä½ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `deepThink?: boolean` - æ˜¯å¦å¼€å¯æ·±åº¦æ€è€ƒã€‚å¦‚æœä¸º trueï¼ŒMidscene ä¼šè°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º False
    - `xpath?: string` - ç›®æ ‡å…ƒç´ çš„ xpath è·¯å¾„ï¼Œç”¨äºæ‰§è¡Œå½“å‰æ“ä½œã€‚å¦‚æœæä¾›äº†è¿™ä¸ª xpathï¼ŒMidscene ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ xpath æ¥æ‰¾åˆ°å…ƒç´ ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨ç¼“å­˜å’Œ AI æ¨¡å‹ã€‚é»˜è®¤å€¼ä¸ºç©º
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True
    - `autoDismissKeyboard?: boolean` - å¦‚æœä¸º trueï¼Œåˆ™é”®ç›˜ä¼šåœ¨è¾“å…¥æ–‡æœ¬åè‡ªåŠ¨å…³é—­ï¼Œä»…åœ¨ Android ä¸­æœ‰æ•ˆã€‚é»˜è®¤å€¼ä¸º trueã€‚

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
await agent.aiInput('Hello World', 'æœç´¢æ¡†');
```

### `agent.aiKeyboardPress()`

æŒ‰ä¸‹é”®ç›˜ä¸Šçš„æŸä¸ªé”®ã€‚

- ç±»å‹

```typescript
function aiKeyboardPress(
  key: string,
  locate?: string,
  options?: Object,
): Promise<void>;
```

- å‚æ•°ï¼š

  - `key: string` - è¦æŒ‰ä¸‹çš„é”®ï¼Œå¦‚ `Enter`ã€`Tab`ã€`Escape` ç­‰ã€‚ä¸æ”¯æŒç»„åˆé”®ã€‚
  - `locate?: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„å…ƒç´ å®šä½ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `deepThink?: boolean` - æ˜¯å¦å¼€å¯æ·±åº¦æ€è€ƒã€‚å¦‚æœä¸º trueï¼ŒMidscene ä¼šè°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º False
    - `xpath?: string` - ç›®æ ‡å…ƒç´ çš„ xpath è·¯å¾„ï¼Œç”¨äºæ‰§è¡Œå½“å‰æ“ä½œã€‚å¦‚æœæä¾›äº†è¿™ä¸ª xpathï¼ŒMidscene ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ xpath æ¥æ‰¾åˆ°å…ƒç´ ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨ç¼“å­˜å’Œ AI æ¨¡å‹ã€‚é»˜è®¤å€¼ä¸ºç©º
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
await agent.aiKeyboardPress('Enter', 'æœç´¢æ¡†');
```

### `agent.aiScroll()`

æ»šåŠ¨é¡µé¢æˆ–æŸä¸ªå…ƒç´ ã€‚

- ç±»å‹

```typescript
function aiScroll(
  scrollParam: PlanningActionParamScroll,
  locate?: string,
  options?: Object,
): Promise<void>;
```

- å‚æ•°ï¼š

  - `scrollParam: PlanningActionParamScroll` - æ»šåŠ¨å‚æ•°
    - `direction: 'up' | 'down' | 'left' | 'right'` - æ»šåŠ¨æ–¹å‘
    - `scrollType: 'once' | 'untilBottom' | 'untilTop' | 'untilRight' | 'untilLeft'` - æ»šåŠ¨ç±»å‹
    - `distance: number` - æ»šåŠ¨è·ç¦»ï¼Œå•ä½ä¸ºåƒç´ ã€‚
  - `locate?: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„å…ƒç´ å®šä½ã€‚å¦‚æœæœªä¼ å…¥ï¼ŒMidscene ä¼šåœ¨å½“å‰é¼ æ ‡ä½ç½®æ»šåŠ¨ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `deepThink?: boolean` - æ˜¯å¦å¼€å¯æ·±åº¦æ€è€ƒã€‚å¦‚æœä¸º trueï¼ŒMidscene ä¼šè°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º False
    - `xpath?: string` - ç›®æ ‡å…ƒç´ çš„ xpath è·¯å¾„ï¼Œç”¨äºæ‰§è¡Œå½“å‰æ“ä½œã€‚å¦‚æœæä¾›äº†è¿™ä¸ª xpathï¼ŒMidscene ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ xpath æ¥æ‰¾åˆ°å…ƒç´ ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨ç¼“å­˜å’Œ AI æ¨¡å‹ã€‚é»˜è®¤å€¼ä¸ºç©º
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
await agent.aiScroll(
  { direction: 'up', distance: 100, scrollType: 'once' },
  'è¡¨å•åŒºåŸŸ',
);
```

### `agent.aiRightClick()`

> ä»…åœ¨ web é¡µé¢ä¸­å¯ç”¨ï¼Œåœ¨ Android ä¸‹ä¸å¯ç”¨

å³é”®ç‚¹å‡»æŸä¸ªå…ƒç´ ã€‚è¯·æ³¨æ„ï¼ŒMidscene åœ¨å³é”®ç‚¹å‡»åæ— æ³•ä¸æµè§ˆå™¨åŸç”Ÿä¸Šä¸‹æ–‡èœå•äº¤äº’ã€‚è¿™ä¸ªæ¥å£é€šå¸¸ç”¨äºå·²ç»ç›‘å¬äº†å³é”®ç‚¹å‡»äº‹ä»¶çš„å…ƒç´ ã€‚

- ç±»å‹

```typescript
function aiRightClick(locate: string, options?: Object): Promise<void>;
```

- å‚æ•°ï¼š

  - `locate: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„å…ƒç´ å®šä½ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `deepThink?: boolean` - æ˜¯å¦å¼€å¯æ·±åº¦æ€è€ƒã€‚å¦‚æœä¸º trueï¼ŒMidscene ä¼šè°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º False
    - `xpath?: string` - ç›®æ ‡å…ƒç´ çš„ xpath è·¯å¾„ï¼Œç”¨äºæ‰§è¡Œå½“å‰æ“ä½œã€‚å¦‚æœæä¾›äº†è¿™ä¸ª xpathï¼ŒMidscene ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ xpath æ¥æ‰¾åˆ°å…ƒç´ ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨ç¼“å­˜å’Œ AI æ¨¡å‹ã€‚é»˜è®¤å€¼ä¸ºç©º
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
await agent.aiRightClick('é¡µé¢é¡¶éƒ¨çš„æ–‡ä»¶åç§°');

// ä½¿ç”¨ deepThink åŠŸèƒ½ç²¾ç¡®å®šä½å…ƒç´ 
await agent.aiRightClick('é¡µé¢é¡¶éƒ¨çš„æ–‡ä»¶åç§°', { deepThink: true });
```

:::tip å…³äº `deepThink` ï¼ˆæ·±åº¦æ€è€ƒï¼‰ç‰¹æ€§

`deepThink` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸ Midscene è°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚è¿™åœ¨ç›®æ ‡å…ƒç´ é¢ç§¯è¾ƒå°ã€éš¾ä»¥å’Œå‘¨å›´å…ƒç´ åŒºåˆ†æ—¶éå¸¸æœ‰ç”¨ã€‚

:::

## æ•°æ®æå–

### `agent.aiAsk()`

ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œä½ å¯ä»¥é’ˆå¯¹å½“å‰é¡µé¢ï¼Œç›´æ¥å‘ AI æ¨¡å‹å‘èµ·æé—®ï¼Œå¹¶è·å¾—å­—ç¬¦ä¸²å½¢å¼çš„å›ç­”ã€‚

- ç±»å‹

```typescript
function aiAsk(prompt: string, options?: Object): Promise<string>;
```

- å‚æ•°ï¼š

  - `prompt: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„è¯¢é—®å†…å®¹ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `domIncluded?: boolean | 'visible-only'` - æ˜¯å¦å‘æ¨¡å‹å‘é€ç²¾ç®€åçš„ DOM ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºæå– UI ä¸­ä¸å¯è§çš„å±æ€§ï¼Œæ¯”å¦‚å›¾ç‰‡çš„é“¾æ¥ã€‚å¦‚æœè®¾ç½®ä¸º `'visible-only'`ï¼Œåˆ™åªå‘é€å¯è§çš„å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º Falseã€‚
    - `screenshotIncluded?: boolean` - æ˜¯å¦å‘æ¨¡å‹å‘é€æˆªå›¾ã€‚é»˜è®¤å€¼ä¸º Trueã€‚

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚è¿”å› AI æ¨¡å‹çš„å›ç­”ã€‚

- ç¤ºä¾‹ï¼š

```typescript
const result = await agent.aiAsk('å½“å‰é¡µé¢çš„åº”è¯¥æ€ä¹ˆè¿›è¡Œæµ‹è¯•ï¼Ÿ');
console.log(result); // è¾“å‡º AI æ¨¡å‹çš„å›ç­”
```

é™¤äº† `aiAsk` æ–¹æ³•ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ `aiQuery` æ–¹æ³•ï¼Œç›´æ¥ä» UI æå–ç»“æ„åŒ–çš„æ•°æ®ã€‚

### `agent.aiQuery()`

ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œä½ å¯ä»¥ç›´æ¥ä» UI æå–ç»“æ„åŒ–çš„æ•°æ®ã€‚åªéœ€åœ¨ `dataDemand` ä¸­æè¿°æœŸæœ›çš„æ•°æ®æ ¼å¼ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€JSONã€æ•°ç»„ç­‰ï¼‰ï¼ŒMidscene å³è¿”å›ç›¸åº”ç»“æœã€‚

- ç±»å‹

```typescript
function aiQuery<T>(dataDemand: string | Object, options?: Object): Promise<T>;
```

- å‚æ•°ï¼š

  - `dataDemand: T`: æè¿°é¢„æœŸçš„è¿”å›å€¼å’Œæ ¼å¼ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `domIncluded?: boolean | 'visible-only'` - æ˜¯å¦å‘æ¨¡å‹å‘é€ç²¾ç®€åçš„ DOM ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºæå– UI ä¸­ä¸å¯è§çš„å±æ€§ï¼Œæ¯”å¦‚å›¾ç‰‡çš„é“¾æ¥ã€‚å¦‚æœè®¾ç½®ä¸º `'visible-only'`ï¼Œåˆ™åªå‘é€å¯è§çš„å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º Falseã€‚
    - `screenshotIncluded?: boolean` - æ˜¯å¦å‘æ¨¡å‹å‘é€æˆªå›¾ã€‚é»˜è®¤å€¼ä¸º Trueã€‚

- è¿”å›å€¼ï¼š

  - è¿”å›å€¼å¯ä»¥æ˜¯ä»»ä½•åˆæ³•çš„åŸºæœ¬ç±»å‹ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€JSONã€æ•°ç»„ç­‰ã€‚
  - ä½ åªéœ€åœ¨ `dataDemand` ä¸­æè¿°å®ƒï¼ŒMidscene å°±ä¼šç»™ä½ æ»¡è¶³æ ¼å¼çš„è¿”å›ã€‚

- ç¤ºä¾‹ï¼š

```typescript
const dataA = await agent.aiQuery({
  time: 'å·¦ä¸Šè§’å±•ç¤ºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œstring',
  userInfo: 'ç”¨æˆ·ä¿¡æ¯ï¼Œ{name: string}',
  tableFields: 'è¡¨æ ¼çš„å­—æ®µåï¼Œstring[]',
  tableDataRecord: 'è¡¨æ ¼ä¸­çš„æ•°æ®è®°å½•ï¼Œ{id: string, [fieldName]: string}[]',
});

// ä½ ä¹Ÿå¯ä»¥ç”¨çº¯å­—ç¬¦ä¸²æè¿°é¢„æœŸçš„è¿”å›å€¼æ ¼å¼ï¼š

// dataB å°†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„
const dataB = await agent.aiQuery('string[]ï¼Œåˆ—è¡¨ä¸­çš„ä»»åŠ¡åç§°');

// dataC å°†æ˜¯ä¸€ä¸ªåŒ…å«å¯¹è±¡çš„æ•°ç»„
const dataC = await agent.aiQuery(
  '{name: string, age: string}[], è¡¨æ ¼ä¸­çš„æ•°æ®è®°å½•',
);

// ä½¿ç”¨ domIncluded åŠŸèƒ½æå– UI ä¸­ä¸å¯è§çš„å±æ€§
const dataD = await agent.aiQuery(
  '{name: string, age: string, avatarUrl: string}[], è¡¨æ ¼ä¸­çš„æ•°æ®è®°å½•',
  { domIncluded: true },
);
```

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾›äº† `aiBoolean()`, `aiNumber()`, `aiString()` ä¸‰ä¸ªä¾¿æ·æ–¹æ³•ï¼Œç”¨äºç›´æ¥æå–å¸ƒå°”å€¼ã€æ•°å­—å’Œå­—ç¬¦ä¸²ã€‚

### `agent.aiBoolean()`

ä» UI ä¸­æå–ä¸€ä¸ªå¸ƒå°”å€¼ã€‚

- ç±»å‹

```typescript
function aiBoolean(prompt: string, options?: Object): Promise<boolean>;
```

- å‚æ•°ï¼š

  - `prompt: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æœŸæœ›å€¼ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `domIncluded?: boolean | 'visible-only'` - æ˜¯å¦å‘æ¨¡å‹å‘é€ç²¾ç®€åçš„ DOM ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºæå– UI ä¸­ä¸å¯è§çš„å±æ€§ï¼Œæ¯”å¦‚å›¾ç‰‡çš„é“¾æ¥ã€‚å¦‚æœè®¾ç½®ä¸º `'visible-only'`ï¼Œåˆ™åªå‘é€å¯è§çš„å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º Falseã€‚
    - `screenshotIncluded?: boolean` - æ˜¯å¦å‘æ¨¡å‹å‘é€æˆªå›¾ã€‚é»˜è®¤å€¼ä¸º Trueã€‚

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚å½“ AI è¿”å›ç»“æœæ—¶è§£æä¸ºå¸ƒå°”å€¼ã€‚

- ç¤ºä¾‹ï¼š

```typescript
const boolA = await agent.aiBoolean('æ˜¯å¦å­˜åœ¨ç™»å½•å¯¹è¯æ¡†');

// ä½¿ç”¨ domIncluded åŠŸèƒ½æå– UI ä¸­ä¸å¯è§çš„å±æ€§
const boolB = await agent.aiBoolean('å¿˜è®°å¯†ç æŒ‰é’®æ˜¯å¦å­˜åœ¨é“¾æ¥', {
  domIncluded: true,
});
```

### `agent.aiNumber()`

ä» UI ä¸­æå–ä¸€ä¸ªæ•°å­—ã€‚

- ç±»å‹

```typescript
function aiNumber(prompt: string, options?: Object): Promise<number>;
```

- å‚æ•°ï¼š

  - `prompt: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æœŸæœ›å€¼ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `domIncluded?: boolean | 'visible-only'` - æ˜¯å¦å‘æ¨¡å‹å‘é€ç²¾ç®€åçš„ DOM ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºæå– UI ä¸­ä¸å¯è§çš„å±æ€§ï¼Œæ¯”å¦‚å›¾ç‰‡çš„é“¾æ¥ã€‚å¦‚æœè®¾ç½®ä¸º `'visible-only'`ï¼Œåˆ™åªå‘é€å¯è§çš„å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º Falseã€‚
    - `screenshotIncluded?: boolean` - æ˜¯å¦å‘æ¨¡å‹å‘é€æˆªå›¾ã€‚é»˜è®¤å€¼ä¸º Trueã€‚

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚å½“ AI è¿”å›ç»“æœæ—¶è§£æä¸ºæ•°å­—ã€‚

- ç¤ºä¾‹ï¼š

```typescript
const numberA = await agent.aiNumber('è´¦æˆ·å‰©ä½™çš„ç§¯åˆ†');

// ä½¿ç”¨ domIncluded åŠŸèƒ½æå– UI ä¸­ä¸å¯è§çš„å±æ€§
const numberB = await agent.aiNumber('è´¦æˆ·å‰©ä½™çš„ç§¯åˆ†å…ƒç´ çš„ value å€¼', {
  domIncluded: true,
});
```

### `agent.aiString()`

ä» UI ä¸­æå–ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

- ç±»å‹

```typescript
function aiString(prompt: string, options?: Object): Promise<string>;
```

- å‚æ•°ï¼š

  - `prompt: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æœŸæœ›å€¼ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `domIncluded?: boolean | 'visible-only'` - æ˜¯å¦å‘æ¨¡å‹å‘é€ç²¾ç®€åçš„ DOM ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºæå– UI ä¸­ä¸å¯è§çš„å±æ€§ï¼Œæ¯”å¦‚å›¾ç‰‡çš„é“¾æ¥ã€‚å¦‚æœè®¾ç½®ä¸º `'visible-only'`ï¼Œåˆ™åªå‘é€å¯è§çš„å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º Falseã€‚
    - `screenshotIncluded?: boolean` - æ˜¯å¦å‘æ¨¡å‹å‘é€æˆªå›¾ã€‚é»˜è®¤å€¼ä¸º Trueã€‚

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚å½“ AI è¿”å›ç»“æœæ—¶è§£æä¸ºå­—ç¬¦ä¸²ã€‚

- ç¤ºä¾‹ï¼š

```typescript
const stringA = await agent.aiString('å½“å‰åˆ—è¡¨çš„ç¬¬ä¸€æ¡è®°å½•çš„åç§°');

// ä½¿ç”¨ domIncluded åŠŸèƒ½æå– UI ä¸­ä¸å¯è§çš„å±æ€§
const stringB = await agent.aiString('å½“å‰åˆ—è¡¨çš„ç¬¬ä¸€æ¡è®°å½•çš„è·³è½¬é“¾æ¥', {
  domIncluded: true,
});
```

## æ›´å¤šæ–¹æ³•

### `agent.aiAssert()`

é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°ä¸€ä¸ªæ–­è¨€æ¡ä»¶ï¼Œè®© AI åˆ¤æ–­è¯¥æ¡ä»¶æ˜¯å¦ä¸ºçœŸã€‚å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼ŒSDK ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¹¶åœ¨é”™è¯¯ä¿¡æ¯ä¸­è¿½åŠ  AI è¿”å›çš„è¯¦ç»†åŸå› ã€‚

- ç±»å‹

```typescript
function aiAssert(assertion: string, errorMsg?: string): Promise<void>;
```

- å‚æ•°ï¼š

  - assertion: string - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æ–­è¨€æ¡ä»¶ã€‚
  - errorMsg?: string - å½“æ–­è¨€å¤±è´¥æ—¶é™„åŠ çš„å¯é€‰é”™è¯¯æç¤ºä¿¡æ¯ã€‚

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚å½“æ–­è¨€æˆåŠŸæ—¶è§£æä¸º voidï¼›è‹¥æ–­è¨€å¤±è´¥ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯åŒ…å« `errorMsg` ä»¥åŠ AI ç”Ÿæˆçš„åŸå› ã€‚

- ç¤ºä¾‹ï¼š

```typescript
await agent.aiAssert('"Sauce Labs Onesie" çš„ä»·æ ¼æ˜¯ 7.99');
```

:::tip
æ–­è¨€åœ¨æµ‹è¯•è„šæœ¬ä¸­éå¸¸é‡è¦ã€‚ä¸ºäº†é™ä½å›  AI å¹»è§‰å¯¼è‡´é”™è¯¯æ–­è¨€çš„é£é™©ï¼ˆä¾‹å¦‚é—æ¼é”™è¯¯ï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `.aiQuery` åŠ ä¸Šå¸¸è§„çš„ JavaScript æ–­è¨€æ¥æ›¿ä»£ `.aiAssert`ã€‚

ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·æ›¿ä»£ä¸Šé¢çš„æ–­è¨€ä»£ç ï¼š

```typescript
const items = await agent.aiQuery(
  '"{name: string, price: number}[], è¿”å›å•†å“åç§°å’Œä»·æ ¼åˆ—è¡¨',
);
const onesieItem = items.find((item) => item.name === 'Sauce Labs Onesie');
expect(onesieItem).toBeTruthy();
expect(onesieItem.price).toBe(7.99);
```

:::

### `agent.aiLocate()`

é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°ä¸€ä¸ªå…ƒç´ çš„å®šä½ã€‚

- ç±»å‹

```typescript
function aiLocate(
  locate: string,
  options?: {
    cacheable?: boolean;
  },
): Promise<{
  rect: {
    left: number;
    top: number;
    width: number;
    height: number;
  };
  center: [number, number];
  scale: number; // device pixel ratio
}>;
```

- å‚æ•°ï¼š

  - `locate: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„å…ƒç´ å®šä½ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `deepThink?: boolean` - æ˜¯å¦å¼€å¯æ·±åº¦æ€è€ƒã€‚å¦‚æœä¸º trueï¼ŒMidscene ä¼šè°ƒç”¨ AI æ¨¡å‹ä¸¤æ¬¡ä»¥ç²¾ç¡®å®šä½å…ƒç´ ã€‚é»˜è®¤å€¼ä¸º False
    - `xpath?: string` - ç›®æ ‡å…ƒç´ çš„ xpath è·¯å¾„ï¼Œç”¨äºæ‰§è¡Œå½“å‰æ“ä½œã€‚å¦‚æœæä¾›äº†è¿™ä¸ª xpathï¼ŒMidscene ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ xpath æ¥æ‰¾åˆ°å…ƒç´ ï¼Œç„¶åä¾æ¬¡ä½¿ç”¨ç¼“å­˜å’Œ AI æ¨¡å‹ã€‚é»˜è®¤å€¼ä¸ºç©º
    - `cacheable?: boolean` - å½“å¯ç”¨ [ç¼“å­˜åŠŸèƒ½](./caching.mdx) æ—¶ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜å½“å‰ API è°ƒç”¨ç»“æœã€‚é»˜è®¤å€¼ä¸º True

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚å½“å…ƒç´ å®šä½æˆåŠŸæ—¶è§£æä¸ºå…ƒç´ å®šä½ä¿¡æ¯ã€‚

- ç¤ºä¾‹ï¼š

```typescript
const locateInfo = await agent.aiLocate('é¡µé¢é¡¶éƒ¨çš„ç™»å½•æŒ‰é’®');
console.log(locateInfo);
```

### `agent.aiWaitFor()`

ç­‰å¾…æŸä¸ªæ¡ä»¶è¾¾æˆã€‚è€ƒè™‘åˆ° AI æœåŠ¡çš„æˆæœ¬ï¼Œæ£€æŸ¥é—´éš”ä¸ä¼šè¶…è¿‡ `checkIntervalMs` æ¯«ç§’ã€‚

- ç±»å‹

```typescript
function aiWaitFor(
  assertion: string,
  options?: {
    timeoutMs?: number;
    checkIntervalMs?: number;
  },
): Promise<void>;
```

- å‚æ•°ï¼š

  - `assertion: string` - ç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æ–­è¨€æ¡ä»¶
  - `options?: object` - å¯é€‰çš„é…ç½®å¯¹è±¡
    - `timeoutMs?: number` - è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸º 15000
    - `checkIntervalMs?: number` - æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸º 3000

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ª Promiseã€‚å½“æ–­è¨€æˆåŠŸæ—¶è§£æä¸º voidï¼›è‹¥è¶…æ—¶ï¼Œåˆ™æŠ›å‡ºé”™è¯¯ã€‚

- ç¤ºä¾‹ï¼š

```typescript
// åŸºæœ¬ç”¨æ³•
await agent.aiWaitFor('ç•Œé¢ä¸Šè‡³å°‘æœ‰ä¸€ä¸ªè€³æœºçš„ä¿¡æ¯');

// ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
await agent.aiWaitFor('è´­ç‰©è½¦å›¾æ ‡æ˜¾ç¤ºæ•°é‡ä¸º 2', {
  timeoutMs: 30000, // ç­‰å¾… 30 ç§’
  checkIntervalMs: 5000, // æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡
});
```

:::tip
è€ƒè™‘åˆ° AI æœåŠ¡çš„æ—¶é—´æ¶ˆè€—ï¼Œ`.aiWaitFor` å¹¶ä¸æ˜¯ä¸€ä¸ªç‰¹åˆ«é«˜æ•ˆçš„æ–¹æ³•ã€‚ä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„ `sleep` å¯èƒ½æ˜¯æ›¿ä»£ `waitFor` çš„å¦ä¸€ç§æ–¹å¼ã€‚
:::

### `agent.runYaml()`

æ‰§è¡Œä¸€ä¸ª YAML æ ¼å¼çš„è‡ªåŠ¨åŒ–è„šæœ¬ã€‚è„šæœ¬ä¸­çš„ `tasks` éƒ¨åˆ†ä¼šè¢«æ‰§è¡Œï¼Œå¹¶è¿”å›æ‰€æœ‰ `.aiQuery` è°ƒç”¨çš„ç»“æœã€‚

- ç±»å‹

```typescript
function runYaml(yamlScriptContent: string): Promise<{ result: any }>;
```

- å‚æ•°ï¼š

  - `yamlScriptContent: string` - YAML æ ¼å¼çš„è„šæœ¬å†…å®¹

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ªåŒ…å« `result` å±æ€§çš„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰ `aiQuery` è°ƒç”¨çš„ç»“æœ

- ç¤ºä¾‹ï¼š

```typescript
const { result } = await agent.runYaml(`
tasks:
  - name: search weather
    flow:
      - ai: input 'weather today' in input box, click search button
      - sleep: 3000

  - name: query weather
    flow:
      - aiQuery: "the result shows the weather info, {description: string}"
`);
console.log(result);
```

:::tip
æ›´å¤šå…³äº YAML è„šæœ¬çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ [Automate with Scripts in YAML](./automate-with-scripts-in-yaml)ã€‚
:::

### `agent.setAIActionContext()`

è®¾ç½®åœ¨è°ƒç”¨ `agent.aiAction()` æ—¶ï¼Œå‘é€ç»™ AI æ¨¡å‹çš„èƒŒæ™¯çŸ¥è¯†ã€‚

- ç±»å‹

```typescript
function setAIActionContext(actionContext: string): void;
```

- å‚æ•°ï¼š

  - `actionContext: string` - è¦å‘é€ç»™ AI æ¨¡å‹çš„èƒŒæ™¯çŸ¥è¯†ã€‚

- ç¤ºä¾‹ï¼š

```typescript
await agent.setAIActionContext('å¦‚æœ â€œä½¿ç”¨cookieâ€ å¯¹è¯æ¡†å­˜åœ¨ï¼Œå…ˆå…³é—­å®ƒ');
```

### `agent.evaluateJavaScript()`

> ä»…åœ¨ web é¡µé¢ä¸­å¯ç”¨ï¼Œåœ¨ Android ä¸‹ä¸å¯ç”¨

è¿™ä¸ªæ–¹æ³•å…è®¸ä½ åœ¨ web é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä¸€æ®µ JavaScript ä»£ç ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚

- ç±»å‹

```typescript
function evaluateJavaScript(script: string): Promise<any>;
```

- å‚æ•°ï¼š

  - `script: string` - è¦æ‰§è¡Œçš„ JavaScript ä»£ç ã€‚

- è¿”å›å€¼ï¼š

  - è¿”å›æ‰§è¡Œç»“æœã€‚

- ç¤ºä¾‹ï¼š

```typescript
const result = await agent.evaluateJavaScript('document.title');
console.log(result);
```

### `agent.logScreenshot()`

åœ¨æŠ¥å‘Šæ–‡ä»¶ä¸­è®°å½•å½“å‰æˆªå›¾ï¼Œå¹¶æ·»åŠ æè¿°ã€‚

- ç±»å‹

```typescript
function logScreenshot(title?: string, options?: Object): Promise<void>;
```

- å‚æ•°ï¼š

  - `title?: string` - å¯é€‰ï¼Œæˆªå›¾çš„æ ‡é¢˜ï¼Œå¦‚æœæœªæä¾›ï¼Œåˆ™æ ‡é¢˜ä¸º 'untitled'ã€‚
  - `options?: Object` - å¯é€‰ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ï¼š
    - `content?: string` - æˆªå›¾çš„æè¿°ã€‚

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
await agent.logScreenshot('ç™»å½•é¡µé¢', {
  content: 'ç”¨æˆ· A',
});
```

### `agent.freezePageContext()`

å†»ç»“å½“å‰é¡µé¢ä¸Šä¸‹æ–‡ï¼Œä½¿åç»­çš„ AI æ“ä½œå¤ç”¨åŒä¸€ä¸ªé¡µé¢å¿«ç…§ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚è¿™å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨åŒä¸€é¡µé¢ä¸Šæ‰§è¡Œå¤šä¸ªè¿ç»­æ“ä½œæ—¶ã€‚

- ç±»å‹

```typescript
function freezePageContext(): Promise<void>;
```

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
// å†»ç»“é¡µé¢ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿å¤šä¸ªæ“ä½œçœ‹åˆ°ç›¸åŒçš„é¡µé¢çŠ¶æ€
await agent.freezePageContext();

// ä»¥ä¸‹æ“ä½œéƒ½ä¼šä½¿ç”¨å†»ç»“æ—¶çš„é¡µé¢å¿«ç…§
const price = await agent.aiQuery('äº§å“ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ');
const inStock = await agent.aiQuery('äº§å“æ˜¯å¦æœ‰è´§ï¼Ÿ');
await agent.aiTap('æ·»åŠ åˆ°è´­ç‰©è½¦æŒ‰é’®');

// è§£å†»é¡µé¢ä¸Šä¸‹æ–‡
await agent.unfreezePageContext();
```

:::tip
åœ¨æŠ¥å‘Šä¸­ï¼Œä½¿ç”¨å†»ç»“ä¸Šä¸‹æ–‡çš„æ“ä½œä¼šåœ¨ Insight tab ä¸­æ˜¾ç¤º ğŸ§Š å›¾æ ‡ã€‚
:::

### `agent.unfreezePageContext()`

è§£å†»é¡µé¢ä¸Šä¸‹æ–‡ï¼Œæ¢å¤ä½¿ç”¨å®æ—¶çš„é¡µé¢çŠ¶æ€ã€‚

- ç±»å‹

```typescript
function unfreezePageContext(): Promise<void>;
```

- è¿”å›å€¼ï¼š

  - `Promise<void>`

- ç¤ºä¾‹ï¼š

```typescript
// å†»ç»“é¡µé¢ä¸Šä¸‹æ–‡
await agent.freezePageContext();

// æ‰§è¡Œä¸€äº›æ“ä½œ...
await Promise.all([
  await agent.aiLocate('ç”¨æˆ·åè¾“å…¥æ¡†');
  await agent.aiQuery('ç”¨æˆ·åè¾“å…¥æ¡†çš„å€¼');
  await agent.aiAssert('å­˜åœ¨ç”¨æˆ·åè¾“å…¥æ¡†');
]);

// è§£å†»é¡µé¢ä¸Šä¸‹æ–‡ï¼Œåç»­æ“ä½œå°†ä½¿ç”¨å®æ—¶é¡µé¢çŠ¶æ€
await agent.unfreezePageContext();

// è¿™ä¸ªæ“ä½œä¼šä½¿ç”¨æ–°çš„é¡µé¢çŠ¶æ€
await agent.aiInput('ç”¨æˆ·åè¾“å…¥æ¡†', 'test@example.com');
```

### `agent._unstableLogContent()`

ä»æŠ¥å‘Šæ–‡ä»¶ä¸­è·å–æ—¥å¿—å†…å®¹ã€‚æ—¥å¿—å†…å®¹çš„ç»“æ„å¯èƒ½ä¼šåœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ã€‚

- ç±»å‹

```typescript
function _unstableLogContent(): Object;
```

- è¿”å›å€¼ï¼š

  - è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ—¥å¿—å†…å®¹ã€‚

- ç¤ºä¾‹ï¼š

```typescript
const logContent = agent._unstableLogContent();
console.log(logContent);
```

## å±æ€§

### `.reportFile`

æŠ¥å‘Šæ–‡ä»¶çš„è·¯å¾„ã€‚

## æ›´å¤šé…ç½®

### åœ¨è¿è¡Œæ—¶è®¾ç½®ç¯å¢ƒå˜é‡

ä½ å¯ä»¥é€šè¿‡ `overrideAIConfig` æ–¹æ³•åœ¨è¿è¡Œæ—¶è®¾ç½®ç¯å¢ƒå˜é‡ã€‚

```typescript
import { overrideAIConfig } from '@midscene/web/puppeteer'; // æˆ–å…¶ä»–çš„ Agent

overrideAIConfig({
  OPENAI_BASE_URL: '...',
  OPENAI_API_KEY: '...',
  MIDSCENE_MODEL_NAME: '...',
});
```

### æ‰“å° AI æ€§èƒ½ä¿¡æ¯

è®¾ç½® `DEBUG=midscene:ai:profile:stats` ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥çœ‹åˆ°æ¯æ¬¡è°ƒç”¨ AI çš„æ—¶é—´å’Œ token æ•°é‡ã€‚

```bash
export DEBUG=midscene:ai:profile:stats
```

### è‡ªå®šä¹‰è¿è¡Œäº§ç‰©ç›®å½•

è®¾ç½® `MIDSCENE_RUN_DIR` å˜é‡ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¿è¡Œäº§ç‰©ç›®å½•ã€‚

```bash
export MIDSCENE_RUN_DIR=midscene_run # é»˜è®¤å€¼ä¸ºå½“å‰è¿è¡Œç›®å½•ä¸‹çš„ midscene_run ç›®å½•ï¼Œæ”¯æŒè®¾ç½®ä¸ºç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹äºå½“å‰ç›®å½•çš„ç›¸å¯¹è·¯å¾„
```

### è‡ªå®šä¹‰é‡æ–°è§„åˆ’å¾ªç¯é™åˆ¶

è®¾ç½® `MIDSCENE_REPLANNING_CYCLE_LIMIT` å˜é‡ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰åœ¨æ‰§è¡Œæ“ä½œ(`aiAction`)æ—¶å…è®¸çš„æœ€å¤§é‡æ–°è§„åˆ’å¾ªç¯æ¬¡æ•°ã€‚

```bash
export MIDSCENE_REPLANNING_CYCLE_LIMIT=10 # é»˜è®¤å€¼ä¸º 10ã€‚å½“ AI éœ€è¦é‡æ–°è§„åˆ’è¶…è¿‡è¿™ä¸ªé™åˆ¶æ—¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯å»ºè®®å°†ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæ­¥éª¤
```

### ä½¿ç”¨ LangSmith

LangSmith æ˜¯ä¸€ä¸ªç”¨äºè°ƒè¯•å¤§è¯­è¨€æ¨¡å‹çš„å¹³å°ã€‚æƒ³è¦é›†æˆ LangSmithï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡

# å¯ç”¨è°ƒè¯•æ ‡å¿—
export MIDSCENE_LANGSMITH_DEBUG=1

# LangSmith é…ç½®
export LANGSMITH_TRACING_V2=true
export LANGSMITH_ENDPOINT="https://api.smith.langchain.com"
export LANGSMITH_API_KEY="your_key_here"
export LANGSMITH_PROJECT="your_project_name_here"
```

å¯åŠ¨ Midscene åï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„æ—¥å¿—ï¼š

```log
DEBUGGING MODE: langsmith wrapper enabled
```
