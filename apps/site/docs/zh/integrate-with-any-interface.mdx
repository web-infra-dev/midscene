import SetupEnv from './common/setup-env.mdx';

# ä¸ä»»æ„ç•Œé¢é›†æˆï¼ˆé¢„è§ˆç‰¹æ€§ï¼‰

ä» Midscene v0.28.0 å¼€å§‹ï¼Œæˆ‘ä»¬æ¨å‡ºäº†ä¸ä»»æ„ç•Œé¢é›†æˆçš„åŠŸèƒ½ã€‚å®šä¹‰ç¬¦åˆ `AbstractInterface` å®šä¹‰çš„ç•Œé¢æ§åˆ¶å™¨ç±»ï¼Œå³å¯è·å¾—ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ Midscene Agentã€‚

è¯¥åŠŸèƒ½çš„å…¸å‹ç”¨é€”æ˜¯æ„å»ºä¸€ä¸ªé’ˆå¯¹ä½ è‡ªå·±ç•Œé¢çš„ GUI è‡ªåŠ¨åŒ– Agentï¼Œæ¯”å¦‚ IoT è®¾å¤‡ã€å†…éƒ¨åº”ç”¨ã€è½¦è½½æ˜¾ç¤ºå™¨ç­‰ã€‚

åœ¨å®ç°äº† UI æ“ä½œçš„ç±»ä¹‹åï¼Œä½ å¯ä»¥è·å¾—ä»¥ä¸‹ç‰¹æ€§ï¼š

- TypeScript çš„ GUI è‡ªåŠ¨åŒ– Agent SDK
- ç”¨äºè°ƒè¯•çš„ Playground
- é€šè¿‡ yaml è„šæœ¬æ§åˆ¶ç•Œé¢
- Midscene Agent çš„å…¨éƒ¨ç‰¹æ€§
- MCP æœåŠ¡å™¨ (ä»åœ¨å¼€å‘ä¸­...)

è¯·æ³¨æ„ï¼šåªæœ‰å…·å¤‡è§†è§‰å®šä½ï¼ˆvisual groundingï¼‰èƒ½åŠ›çš„æ¨¡å‹æ‰èƒ½ç”¨äºæ“ä½œ UI ç•Œé¢ã€‚è¯·é˜…è¯»æ–‡æ¡£ä»¥[é€‰æ‹©åˆé€‚çš„æ¨¡å‹](./choose-a-model)ã€‚


:::tip é¢„è§ˆåŠŸèƒ½è¯´æ˜
æ­¤åŠŸèƒ½ä»åœ¨é¢„è§ˆé˜¶æ®µï¼Œæ¬¢è¿ä½ åœ¨ [GitHub](https://github.com/web-infra-dev/midscene/issues) ä¸Šç»™æˆ‘ä»¬æå»ºè®®ã€‚
:::

## æ¼”ç¤ºå’Œç¤¾åŒºé¡¹ç›®

æˆ‘ä»¬å·²ç»ä¸ºä½ å‡†å¤‡äº†ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œå¸®åŠ©ä½ å­¦ä¹ å¦‚ä½•å®šä¹‰è‡ªå·±çš„ç•Œé¢ç±»ã€‚å¼ºçƒˆå»ºè®®ä½ æŸ¥çœ‹ä¸€ä¸‹ã€‚

* [æ¼”ç¤ºé¡¹ç›®](https://github.com/web-infra-dev/midscene-example/tree/main/custom-interface) - ä¸€ä¸ªç®€å•çš„æ¼”ç¤ºé¡¹ç›®ï¼Œå±•ç¤ºå¦‚ä½•å®šä¹‰è‡ªå·±çš„ç•Œé¢ç±»

* [Android (adb) Agent](https://github.com/web-infra-dev/midscene/blob/main/packages/android/src/device.ts) - è¿™æ˜¯ Midscene Android (adb) Agentï¼ŒåŒæ ·ä¾èµ–æ­¤ç‰¹æ€§å®ç°

è¿˜æœ‰ä¸€äº›ä½¿ç”¨æ­¤åŠŸèƒ½çš„ç¤¾åŒºé¡¹ç›®ï¼š

* [midscene-ios](https://github.com/lhuanyu/midscene-ios) - ä½¿ç”¨ Midscene é©±åŠ¨ "iPhone é•œåƒ" åº”ç”¨çš„é¡¹ç›®


<SetupEnv />

## å®ç°ä½ è‡ªå·±çš„ç•Œé¢ç±»

### å…³é”®æ¦‚å¿µ

* `AbstractInterface` ç±»ï¼šä¸€ä¸ªé¢„å®šä¹‰çš„æŠ½è±¡ç±»ï¼Œå¯ä»¥è¿æ¥åˆ° Midscene æ™ºèƒ½ä½“
* **åŠ¨ä½œç©ºé—´**ï¼šæè¿°å¯ä»¥åœ¨ç•Œé¢ä¸Šæ‰§è¡Œçš„åŠ¨ä½œé›†åˆã€‚è¿™å°†å½±å“ AI æ¨¡å‹å¦‚ä½•è§„åˆ’å’Œæ‰§è¡ŒåŠ¨ä½œ

### æ­¥éª¤ 1. ä» demo é¡¹ç›®å¼€å§‹

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œè¿è¡Œäº†æœ¬æ–‡æ¡£ä¸­çš„æ‰€æœ‰åŠŸèƒ½ã€‚è¿™æ˜¯æœ€å¿«çš„å¯åŠ¨æ–¹å¼ã€‚

```bash
# å‡†å¤‡é¡¹ç›®
git clone https://github.com/web-infra-dev/midscene-example.git
cd midscene-example/custom-interface
npm install
npm run build

# è¿è¡Œæ¼”ç¤º
npm run demo
```

### æ­¥éª¤ 2. å®ç°ä½ çš„ç•Œé¢ç±»

å®šä¹‰ä¸€ä¸ªç»§æ‰¿ `AbstractInterface` ç±»çš„ç±»ï¼Œå¹¶å®ç°æ‰€éœ€çš„æ–¹æ³•ã€‚

ä½ å¯ä»¥ä» [`./src/sample-device.ts`](https://github.com/web-infra-dev/midscene-example/blob/main/custom-interface/src/sample-device.ts) æ–‡ä»¶ä¸­è·å–ç¤ºä¾‹å®ç°ã€‚è®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸‹ã€‚

```typescript
import type { DeviceAction, Size } from '@midscene/core';
import { getMidsceneLocationSchema, z } from '@midscene/core';
import {
  type AbstractInterface,
  defineAction,
  defineActionTap,
  defineActionInput,
  // ... å…¶ä»–åŠ¨ä½œå¯¼å…¥
} from '@midscene/core/device';

export interface SampleDeviceConfig {
  deviceName?: string;
  width?: number;
  height?: number;
  dpr?: number;
}

/**
 * SampleDevice - AbstractInterface çš„æ¨¡æ¿å®ç°
 */
export class SampleDevice implements AbstractInterface {
  interfaceType = 'sample-device';
  private config: Required<SampleDeviceConfig>;

  constructor(config: SampleDeviceConfig = {}) {
    this.config = {
      deviceName: config.deviceName || 'Sample Device',
      width: config.width || 1920,
      height: config.height || 1080,
      dpr: config.dpr || 1,
    };
  }

  /**
   * å¿…éœ€ï¼šæˆªå–å±å¹•æˆªå›¾å¹¶è¿”å› base64 å­—ç¬¦ä¸²
   */
  async screenshotBase64(): Promise<string> {
    // TODOï¼šå®ç°å®é™…çš„å±å¹•æˆªå›¾æ•è·
    console.log('ğŸ“¸ Taking screenshot...');
    return 'data:image/png;base64,...'; // ä½ çš„å±å¹•æˆªå›¾å®ç°
  }

  /**
   * å¿…éœ€ï¼šè·å–ç•Œé¢å°ºå¯¸
   */
  async size(): Promise<Size> {
    return {
      width: this.config.width,
      height: this.config.height,
      dpr: this.config.dpr,
    };
  }

  /**
   * å¿…éœ€ï¼šå®šä¹‰ AI æ¨¡å‹çš„å¯ç”¨åŠ¨ä½œ
   */
  actionSpace(): DeviceAction[] {
    return [
      // åŸºç¡€ç‚¹å‡»åŠ¨ä½œ
      defineActionTap(async (param) => {
        // TODOï¼šå®ç°åœ¨ param.locate.center åæ ‡çš„ç‚¹å‡»
        await this.performTap(param.locate.center[0], param.locate.center[1]);
      }),

      // æ–‡æœ¬è¾“å…¥åŠ¨ä½œ  
      defineActionInput(async (param) => {
        // TODOï¼šå®ç°æ–‡æœ¬è¾“å…¥
        await this.performInput(param.locate.center[0], param.locate.center[1], param.value);
      }),

      // è‡ªå®šä¹‰åŠ¨ä½œç¤ºä¾‹
      defineAction({
        name: 'CustomAction',
        description: 'ä½ çš„è‡ªå®šä¹‰è®¾å¤‡ç‰¹å®šåŠ¨ä½œ',
        paramSchema: z.object({
          locate: getMidsceneLocationSchema(),
          // ... è‡ªå®šä¹‰å‚æ•°
        }),
        call: async (param) => {
          // TODOï¼šå®ç°è‡ªå®šä¹‰åŠ¨ä½œ
        },
      }),
    ];
  }

  async destroy(): Promise<void> {
    // TODOï¼šæ¸…ç†èµ„æº
  }

  // ç§æœ‰å®ç°æ–¹æ³•
  private async performTap(x: number, y: number): Promise<void> {
    // TODOï¼šä½ çš„å®é™…ç‚¹å‡»å®ç°
  }

  private async performInput(x: number, y: number, text: string): Promise<void> {
    // TODOï¼šä½ çš„å®é™…è¾“å…¥å®ç°  
  }
}
```

éœ€è¦å®ç°çš„å…³é”®æ–¹æ³•æœ‰ï¼š
- `screenshotBase64()`ã€`size()`ï¼šå¸®åŠ© AI æ¨¡å‹è·å–ç•Œé¢ä¸Šä¸‹æ–‡
- `actionSpace()`ï¼šä¸€ä¸ªç”± `DeviceAction` ç»„æˆçš„æ•°ç»„ï¼Œå®šä¹‰äº†åœ¨ç•Œé¢ä¸Šå¯ä»¥æ‰§è¡Œçš„åŠ¨ä½œã€‚AI æ¨¡å‹å°†ä½¿ç”¨è¿™äº›åŠ¨ä½œæ¥æ‰§è¡Œæ“ä½œã€‚Midscene å·²ä¸ºå¸¸è§ç•Œé¢ä¸è®¾å¤‡æä¾›äº†é¢„å®šä¹‰åŠ¨ä½œç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå®šä¹‰ä»»ä½•è‡ªå®šä¹‰åŠ¨ä½œã€‚

ä½¿ç”¨è¿™äº›å‘½ä»¤è¿è¡Œ Agentï¼š

- `npm run build` é‡æ–°ç¼–è¯‘ Agent ä»£ç 
- `npm run demo` ä½¿ç”¨ JavaScript è¿è¡Œæ™ºèƒ½ä½“
- `npm run demo:yaml` ä½¿ç”¨ yaml è„šæœ¬è¿è¡Œæ™ºèƒ½ä½“


### æ­¥éª¤ 3. ä½¿ç”¨ Playground æµ‹è¯• Agent

ä¸º Agent é™„åŠ ä¸€ä¸ª Playground æœåŠ¡ï¼Œå³å¯åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ä½ çš„ Agentã€‚

```ts 
import 'dotenv/config'; // ä» .env æ–‡ä»¶é‡Œè¯»å– Midscene ç¯å¢ƒå˜é‡
import { playgroundForAgent } from '@midscene/playground';

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

// å®ä¾‹åŒ– device å’Œ agent
const device = new SampleDevice();
await device.launch();
const agent new Agent({
  foo: 'bar',
});

// å¯åŠ¨ playground
const server = await playgroundForAgent(agent).launch();

// å…³é—­ Playground
await sleep(10 * 60 * 1000);
await server.close();
console.log('Playground å·²å…³é—­ï¼');
```

### æ­¥éª¤ 4. æµ‹è¯• MCP æœåŠ¡

ï¼ˆä»åœ¨å¼€å‘ä¸­ï¼‰

### æ­¥éª¤ 5. å‘å¸ƒ npm åŒ…ï¼Œè®©ä½ çš„ç”¨æˆ·ä½¿ç”¨å®ƒ

`./index.ts` æ–‡ä»¶å·²ç»å¯¼å‡ºäº†ä½ çš„ Agent ä¸ç•Œé¢ç±»ã€‚ç°åœ¨å¯ä»¥å‘å¸ƒåˆ° npmã€‚

åœ¨ `package.json` æ–‡ä»¶ä¸­å¡«å†™ `name` å’Œ `version`ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
npm publish
```

ä½ çš„ npm åŒ…çš„å…¸å‹ç”¨æ³•å¦‚ä¸‹ï¼š

```typescript
import 'dotenv/config'; // ä» .env æ–‡ä»¶é‡Œè¯»å– Midscene ç¯å¢ƒå˜é‡
import { playgroundForAgent } from '@midscene/playground';

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

// å®ä¾‹åŒ– device å’Œ agent
const device = new SampleDevice();
await device.launch();
const agent new Agent({
  foo: 'bar',
});

await agent.aiAction('click the button');
```

### æ­¥éª¤ 6. åœ¨ Midscene CLI å’Œ YAML è„šæœ¬ä¸­è°ƒç”¨ä½ çš„ç±»

ç¼–å†™ä¸€ä¸ªåŒ…å« `interface` å­—æ®µçš„ yaml è„šæœ¬æ¥è°ƒç”¨ä½ çš„ç±»ï¼š

```yaml
interface:
  module: 'my-pkg-name'
  # export: 'MyDeviceClass' # å¦‚æœæ˜¯å…·åå¯¼å‡ºï¼Œä½¿ç”¨è¯¥å­—æ®µ

config:
  output: './data.json'
```

è¯¥é…ç½®ç­‰ä»·äºï¼š

```typescript
import MyDeviceClass from 'my-pkg-name';
const device = new MyDeviceClass();
const agent = new Agent(device, {
  output: './data.json',
});
```

YAML çš„å…¶ä»–å­—æ®µä¸[è‡ªåŠ¨åŒ–è„šæœ¬](./automate-with-scripts-in-yaml.html)æ–‡æ¡£ä¸€è‡´ã€‚

## API å‚è€ƒ

### `AbstractInterface` ç±»

```typescript
import { AbstractInterface } from '@midscene/core';
```

`AbstractInterface` æ˜¯æ™ºèƒ½ä½“æ§åˆ¶ç•Œé¢çš„å…³é”®ç±»ã€‚

ä»¥ä¸‹æ˜¯ä½ éœ€è¦å®ç°çš„å¿…éœ€æ–¹æ³•ï¼š

- `interfaceType: string`ï¼šä¸ºç•Œé¢å®šä¹‰ä¸€ä¸ªåç§°ï¼Œè¿™ä¸ä¼šæä¾›ç»™ AI æ¨¡å‹
- `screenshotBase64(): Promise<string>`ï¼šæˆªå–ç•Œé¢çš„å±å¹•æˆªå›¾å¹¶è¿”å›å¸¦æœ‰ `'data:image/` å‰ç¼€çš„ base64 å­—ç¬¦ä¸²
- `size(): Promise<Size>`ï¼šç•Œé¢çš„å¤§å°å’Œ dprï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰ `width`ã€`height` å’Œ `dpr` å±æ€§çš„å¯¹è±¡
- `actionSpace(): DeviceAction[] | Promise<DeviceAction[]>`ï¼šç•Œé¢çš„åŠ¨ä½œç©ºé—´ï¼Œå®ƒæ˜¯ä¸€ä¸ª `DeviceAction` å¯¹è±¡æ•°ç»„ã€‚åœ¨è¿™é‡Œä½ å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰åŠ¨ä½œï¼Œæˆ–æ˜¯è‡ªå®šä¹‰äº¤äº’æ“ä½œã€‚

ç±»å‹ç­¾åï¼š

```ts
import type { DeviceAction, Size, UIContext } from '@midscene/core';
import type { ElementNode } from '@midscene/shared/extractor';

abstract class AbstractInterface {
  // å¿…é€‰
  abstract interfaceType: string;
  abstract screenshotBase64(): Promise<string>;
  abstract size(): Promise<Size>;
  abstract actionSpace(): DeviceAction[] | Promise<DeviceAction[]>;

  // å¯é€‰ï¼šç”Ÿå‘½å‘¨æœŸ/é’©å­
  abstract destroy?(): Promise<void>;
  abstract describe?(): string;
  abstract beforeInvokeAction?(actionName: string, param: any): Promise<void>;
  abstract afterInvokeAction?(actionName: string, param: any): Promise<void>;
}
```

ä»¥ä¸‹æ˜¯ä½ å¯ä»¥å®ç°çš„å¯é€‰æ–¹æ³•ï¼š

- `destroy?(): Promise<void>`ï¼šé”€æ¯
- `describe?(): string`ï¼šç•Œé¢æè¿°ï¼Œè¿™å¯èƒ½ä¼šç”¨äºæŠ¥å‘Šå’Œ Playgroundï¼Œä½†ä¸ä¼šæä¾›ç»™ AI æ¨¡å‹
- `beforeInvokeAction?(actionName: string, param: any): Promise<void>`ï¼šåœ¨åŠ¨ä½œç©ºé—´ä¸­è°ƒç”¨åŠ¨ä½œä¹‹å‰çš„é’©å­å‡½æ•°
- `afterInvokeAction?(actionName: string, param: any): Promise<void>`ï¼šåœ¨è°ƒç”¨åŠ¨ä½œä¹‹åçš„é’©å­å‡½æ•°

### åŠ¨ä½œç©ºé—´ï¼ˆAction Spaceï¼‰

åŠ¨ä½œç©ºé—´æ˜¯ç•Œé¢ä¸Šå¯æ‰§è¡ŒåŠ¨ä½œçš„é›†åˆã€‚AI æ¨¡å‹å°†ä½¿ç”¨è¿™äº›åŠ¨ä½œæ¥æ‰§è¡Œæ“ä½œã€‚æ‰€æœ‰åŠ¨ä½œçš„æè¿°å’Œå‚æ•°æ¨¡å¼éƒ½ä¼šæä¾›ç»™ AI æ¨¡å‹ã€‚

ä¸ºäº†å¸®åŠ©ä½ è½»æ¾å®šä¹‰åŠ¨ä½œç©ºé—´ï¼ŒMidscene ä¸ºæœ€å¸¸è§çš„ç•Œé¢å’Œè®¾å¤‡æä¾›äº†ä¸€ç»„é¢„å®šä¹‰çš„åŠ¨ä½œï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå®šä¹‰ä»»æ„è‡ªå®šä¹‰åŠ¨ä½œã€‚

ä»¥ä¸‹æ˜¯å¦‚ä½•å¯¼å…¥å·¥å…·æ¥å®šä¹‰åŠ¨ä½œç©ºé—´ï¼š

```typescript
import {
	type ActionTapParam,
	defineAction,
	defineActionTap,
} from "@midscene/core/device";
```

#### é¢„å®šä¹‰çš„åŠ¨ä½œ

è¿™äº›æ˜¯æœ€å¸¸è§ç•Œé¢å’Œè®¾å¤‡çš„é¢„å®šä¹‰åŠ¨ä½œç©ºé—´ã€‚ä½ å¯ä»¥é€šè¿‡å®ç°åŠ¨ä½œçš„è°ƒç”¨æ–¹æ³•å°†å®ƒä»¬æš´éœ²ç»™å®šåˆ¶åŒ–ç•Œé¢ã€‚

ä½ å¯ä»¥åœ¨è¿™äº›å‡½æ•°çš„ç±»å‹å®šä¹‰ä¸­æ‰¾åˆ°åŠ¨ä½œçš„å‚æ•°ã€‚

* `defineActionTap()`ï¼šå®šä¹‰ç‚¹å‡»åŠ¨ä½œã€‚è¿™ä¹Ÿæ˜¯ `aiTap` æ–¹æ³•çš„è°ƒç”¨å‡½æ•°ã€‚
* `defineActionDoubleClick()`ï¼šå®šä¹‰åŒå‡»åŠ¨ä½œ
* `defineActionInput()`ï¼šå®šä¹‰è¾“å…¥åŠ¨ä½œã€‚è¿™ä¹Ÿæ˜¯ `aiInput` æ–¹æ³•çš„è°ƒç”¨å‡½æ•°ã€‚è¿™ä¹Ÿæ˜¯ `aiInput` æ–¹æ³•çš„è°ƒç”¨å‡½æ•°ã€‚
* `defineActionKeyboardPress()`ï¼šå®šä¹‰é”®ç›˜æŒ‰ä¸‹åŠ¨ä½œã€‚è¿™ä¹Ÿæ˜¯ `aiKeyboardPress` æ–¹æ³•çš„è°ƒç”¨å‡½æ•°ã€‚
* `defineActionScroll()`ï¼šå®šä¹‰æ»šåŠ¨åŠ¨ä½œã€‚è¿™ä¹Ÿæ˜¯ `aiScroll` æ–¹æ³•çš„è°ƒç”¨å‡½æ•°ã€‚
* `defineActionDragAndDrop()`ï¼šå®šä¹‰æ‹–æ”¾åŠ¨ä½œ
* `defineActionLongPress()`ï¼šå®šä¹‰é•¿æŒ‰åŠ¨ä½œ
* `defineActionSwipe()`ï¼šå®šä¹‰æ»‘åŠ¨åŠ¨ä½œ

#### å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰åŠ¨ä½œ

ä½ å¯ä»¥ä½¿ç”¨ `defineAction()` å‡½æ•°å®šä¹‰è‡ªå·±çš„åŠ¨ä½œã€‚

API ç­¾åï¼š

```typescript
import { defineAction } from "@midscene/core/device";

defineAction(
  {
    name: string,
    description: string,
    paramSchema: z.ZodType<T>;
    call: (param: z.infer<z.ZodType<T>>) => Promise<void>;
  }
)
```

* `name`ï¼šåŠ¨ä½œçš„åç§°ï¼ŒAI æ¨¡å‹å°†ä½¿ç”¨æ­¤åç§°è°ƒç”¨åŠ¨ä½œ
* `description`ï¼šåŠ¨ä½œçš„æè¿°ï¼ŒAI æ¨¡å‹å°†ä½¿ç”¨æ­¤æè¿°æ¥ç†è§£åŠ¨ä½œçš„ä½œç”¨ã€‚å¯¹äºå¤æ‚åŠ¨ä½œï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œç»™å‡ºæ›´è¯¦ç»†çš„ç¤ºä¾‹è¯´æ˜
* `paramSchema`ï¼šåŠ¨ä½œå‚æ•°çš„ [Zod](https://www.npmjs.com/package/zod) æ¨¡å¼ï¼ŒAI æ¨¡å‹å°†æ ¹æ®æ­¤æ¨¡å¼å¸®åŠ©å¡«å……å‚æ•°
* `call`ï¼šè°ƒç”¨åŠ¨ä½œçš„å‡½æ•°ï¼Œä½ å¯ä»¥ä»ç¬¦åˆ `paramSchema` çš„ `param` å‚æ•°ä¸­è·å–å‚æ•°


ç¤ºä¾‹ï¼š

```typescript
defineAction({
  name: 'MyAction',
  description: 'My action',
  paramSchema: z.object({
    name: z.string(),
  }),
  call: async (param) => {
    console.log(param.name);
  },
});
```

å¦‚æœä½ æƒ³è¦è·å–æŸä¸ªå…ƒç´ ä½ç½®ç›¸å…³çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ `getMidsceneLocationSchema()` å‡½æ•°è·å–ç‰¹å®šçš„ zod æ¨¡å¼ã€‚

ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œå…³äºå¦‚ä½•å®šä¹‰è‡ªå®šä¹‰åŠ¨ä½œï¼š

```typescript
import { getMidsceneLocationSchema } from "@midscene/core/device";

defineAction({
  name: 'LaunchApp',
  description: 'å¯åŠ¨å±å¹•ä¸Šçš„åº”ç”¨',
  paramSchema: z.object({
    name: z.string().describe('è¦å¯åŠ¨çš„åº”ç”¨åç§°'),
    locate: getMidsceneLocationSchema().describe('è¦å¯åŠ¨çš„åº”ç”¨å›¾æ ‡'),
  }),
  call: async (param) => {
    console.log(`launching app: ${param.name}, ui located at: ${JSON.stringify(param.locate.center)}`);
  },
});
```

### `playgroundForAgent` å‡½æ•°

```typescript
import { playgroundForAgent } from '@midscene/playground';
```

`playgroundForAgent` å‡½æ•°ç”¨äºä¸ºç‰¹å®šçš„ Agent åˆ›å»ºä¸€ä¸ª Playground å¯åŠ¨å™¨ï¼Œè®©ä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•å’Œè°ƒè¯•ä½ çš„è‡ªå®šä¹‰ç•Œé¢ Agentã€‚

#### å‡½æ•°ç­¾å

```typescript
function playgroundForAgent(agent: Agent): {
  launch(options?: LaunchPlaygroundOptions): Promise<LaunchPlaygroundResult>
}
```

#### å‚æ•°

- `agent: Agent`ï¼šè¦ä¸ºå…¶å¯åŠ¨ Playground çš„ Agent å®ä¾‹

#### è¿”å›å€¼

è¿”å›ä¸€ä¸ªåŒ…å« `launch` æ–¹æ³•çš„å¯¹è±¡ã€‚

#### `launch` æ–¹æ³•é€‰é¡¹

```typescript
interface LaunchPlaygroundOptions {
  /**
   * Playground æœåŠ¡å™¨ç«¯å£
   * @default 5800
   */
  port?: number;

  /**
   * æ˜¯å¦è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Playground
   * @default true
   */
  openBrowser?: boolean;

  /**
   * è‡ªå®šä¹‰æµè§ˆå™¨æ‰“å¼€å‘½ä»¤
   * @default macOS ä½¿ç”¨ 'open'ï¼ŒWindows ä½¿ç”¨ 'start'ï¼ŒLinux ä½¿ç”¨ 'xdg-open'
   */
  browserCommand?: string;

  /**
   * æ˜¯å¦æ˜¾ç¤ºæœåŠ¡å™¨æ—¥å¿—
   * @default true
   */
  verbose?: boolean;

  /**
   * Playground æœåŠ¡å™¨å®ä¾‹çš„å”¯ä¸€æ ‡è¯† ID
   * åŒä¸€ä¸ª ID å…±ç”¨ Playground å¯¹è¯å†å²
   * @default undefinedï¼ˆç”Ÿæˆéšæœº UUIDï¼‰
   */
  id?: string;
}
```

#### `launch` æ–¹æ³•è¿”å›å€¼

```typescript
interface LaunchPlaygroundResult {
  /**
   * Playground æœåŠ¡å™¨å®ä¾‹
   */
  server: PlaygroundServer;

  /**
   * æœåŠ¡å™¨ç«¯å£
   */
  port: number;

  /**
   * æœåŠ¡å™¨ä¸»æœºåœ°å€
   */
  host: string;

  /**
   * å…³é—­ Playground çš„å‡½æ•°
   */
  close: () => Promise<void>;
}
```

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
import 'dotenv/config';
import { playgroundForAgent } from '@midscene/playground';
import { SampleDevice } from './sample-device';
import { Agent } from '@midscene/core/agent';

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

// åˆ›å»ºè®¾å¤‡å’Œ Agent å®ä¾‹
const device = new SampleDevice();
const agent = new Agent(device);

// å¯åŠ¨ Playground
const result = await playgroundForAgent(agent).launch({
  port: 5800,
  openBrowser: true,
  verbose: true
});

console.log(`Playground å·²å¯åŠ¨ï¼šhttp://${result.host}:${result.port}`);

// åœ¨éœ€è¦æ—¶å…³é—­ Playground
await sleep(10 * 60 * 1000); // ç­‰å¾… 10 åˆ†é’Ÿ
await result.close();
console.log('Playground å·²å…³é—­ï¼');
```

## å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

**æˆ‘å¯ä»¥ä½¿ç”¨æ™®é€šçš„ LLM æ¨¡å‹ï¼ˆå¦‚ GPT-4oï¼‰æ¥æ§åˆ¶ç•Œé¢å—ï¼Ÿ**

ä¸å¯ä»¥ï¼Œä½ ä¸èƒ½ä½¿ç”¨æ™®é€šçš„ LLM æ¨¡å‹ï¼ˆå¦‚ GPT-4oï¼‰æ¥æ§åˆ¶ç•Œé¢ã€‚ä½ å¿…é¡»ä½¿ç”¨å…·å¤‡è§†è§‰å®šä½èƒ½åŠ›çš„æ¨¡å‹ã€‚å…·å¤‡è§†è§‰å®šä½èƒ½åŠ›çš„æ¨¡å‹å¯ä»¥åœ¨é¡µé¢ä¸Šå®šä½ç›®æ ‡å…ƒç´ å¹¶è¿”å›å…ƒç´ çš„åæ ‡ï¼Œè¿™èƒ½æ˜¾è‘—æå‡è‡ªåŠ¨åŒ–çš„ç¨³å®šæ€§ã€‚

è¯·é˜…è¯»æ–‡æ¡£ä»¥[é€‰æ‹©åˆé€‚çš„æ¨¡å‹](./choose-a-model)ã€‚

**æˆ‘çš„ interface-controller å¯ä»¥åœ¨æœ¬æ–‡æ¡£ä¸­è¢«æ¨èå—ï¼Ÿ**

å¯ä»¥ï¼Œæˆ‘ä»¬å¾ˆä¹æ„æ”¶é›†æœ‰åˆ›æ„çš„é¡¹ç›®å¹¶å°†å®ƒä»¬åˆ—åœ¨æœ¬æ–‡æ¡£ä¸­ã€‚

å½“é¡¹ç›®å‡†å¤‡å¥½åï¼Œ[ç»™æˆ‘ä»¬æä¸€ä¸ª issue](https://github.com/web-infra-dev/midscene/issues)ã€‚
