# é›†æˆåˆ° Playwright

import { PackageManagerTabs } from '@theme';

[Playwright.js](https://playwright.com/) æ˜¯ç”±å¾®è½¯å¼€å‘çš„ä¸€ä¸ªå¼€æºè‡ªåŠ¨åŒ–åº“ï¼Œä¸»è¦ç”¨äºå¯¹ç½‘ç»œåº”ç”¨ç¨‹åºè¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆend-to-end testï¼‰å’Œç½‘é¡µæŠ“å–ã€‚

è¿™é‡Œæˆ‘ä»¬å‡è®¾ä½ å·²ç»æ‹¥æœ‰ä¸€ä¸ªé›†æˆäº† Playwright çš„ä»“åº“ã€‚

:::info æ ·ä¾‹é¡¹ç›®
ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å‘ Playwright é›†æˆçš„æ ·ä¾‹é¡¹ç›®ï¼š[https://github.com/web-infra-dev/midscene-example/blob/main/playwright-demo](https://github.com/web-infra-dev/midscene-example/blob/main/playwright-demo)
:::


## å‡†å¤‡å·¥ä½œ

é…ç½® OpenAI API Keyï¼Œæˆ– [è‡ªå®šä¹‰æ¨¡å‹å’ŒæœåŠ¡å•†](./model-provider.html)

```bash
# æ›´æ–°ä¸ºä½ è‡ªå·±çš„ Key
export OPENAI_API_KEY="sk-abcdefghijklmnopqrstuvwxyz"
```

## ç¬¬ä¸€æ­¥ï¼šæ–°å¢ä¾èµ–ï¼Œæ›´æ–°é…ç½®æ–‡ä»¶

æ–°å¢ä¾èµ–

<PackageManagerTabs command="install @midscene/web --save-dev" />

æ›´æ–° playwright.config.ts

```diff
export default defineConfig({
  testDir: './e2e',
+ timeout: 90 * 1000,
+ reporter: [["list"], ["@midscene/web/playwright-report"]],
});
```

## ç¬¬äºŒæ­¥ï¼šæ‰©å±• `test` å®ä¾‹

æŠŠä¸‹æ–¹ä»£ç ä¿å­˜ä¸º `./e2e/fixture.ts`;

```typescript
import { test as base } from '@playwright/test';
import type { PlayWrightAiFixtureType } from '@midscene/web/playwright';
import { PlaywrightAiFixture } from '@midscene/web/playwright';

export const test = base.extend<PlayWrightAiFixtureType>(PlaywrightAiFixture());
```

## ç¬¬ä¸‰æ­¥ï¼šç¼–å†™æµ‹è¯•ç”¨ä¾‹

ç¼–å†™ä¸‹æ–¹ä»£ç ï¼Œä¿å­˜ä¸º `./e2e/ebay-search.spec.ts`

```typescript title="./e2e/ebay-search.spec.ts"
import { expect } from "@playwright/test";
import { test } from "./fixture";

test.beforeEach(async ({ page }) => {
  page.setViewportSize({ width: 400, height: 905 });
  await page.goto("https://www.ebay.com");
  await page.waitForLoadState("networkidle");
});

test("search headphone on ebay", async ({ ai, aiQuery, aiAssert }) => {
  // ğŸ‘€ è¾“å…¥å…³é”®å­—ï¼Œæ‰§è¡Œæœç´¢
  // æ³¨ï¼šå°½ç®¡è¿™æ˜¯ä¸€ä¸ªè‹±æ–‡é¡µé¢ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ä¸­æ–‡æŒ‡ä»¤æ§åˆ¶å®ƒ
  await ai('åœ¨æœç´¢æ¡†è¾“å…¥ "Headphones" ï¼Œæ•²å›è½¦');

  // ğŸ‘€ æ‰¾åˆ°åˆ—è¡¨é‡Œè€³æœºç›¸å…³çš„ä¿¡æ¯
  const items = await aiQuery(
    '{itemTitle: string, price: Number}[], æ‰¾åˆ°åˆ—è¡¨é‡Œçš„å•†å“æ ‡é¢˜å’Œä»·æ ¼'
  );

  console.log("headphones in stock", items);
  expect(items?.length).toBeGreaterThan(0);

  // ğŸ‘€ ç”¨ AI æ–­è¨€
  await aiAssert("ç•Œé¢å·¦ä¾§æœ‰ç±»ç›®ç­›é€‰åŠŸèƒ½");
});

```

## Step 4. è¿è¡Œæµ‹è¯•ç”¨ä¾‹

```bash
npx playwright test ./e2e/ebay-search.spec.ts
```

## Step 5. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

å½“ä¸Šé¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºï¼š`Midscene - report file updated: ./current_cwd/midscene_run/report/some_id.html`ï¼Œé€šè¿‡æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶å³å¯çœ‹åˆ°æŠ¥å‘Šã€‚

## æ›´å¤š

ä½ å¯èƒ½è¿˜æƒ³äº†è§£ [æç¤ºè¯æŠ€å·§](./prompting-tips.html)
