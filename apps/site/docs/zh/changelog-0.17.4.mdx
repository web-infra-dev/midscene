# v0.17.4 æ›´æ–°æ—¥å¿—ï¼šè®© AI çœ‹è§é¡µé¢ DOMï¼

## æ•°æ®æŸ¥è¯¢ API å…¨é¢å¢å¼º

ä¸ºæ»¡è¶³æ›´å¤šå‰ç«¯è‡ªåŠ¨åŒ–å’Œæ•°æ®æå–åœºæ™¯ï¼Œä»¥ä¸‹ API æ–°å¢äº† options å‚æ•°ï¼Œæ”¯æŒæ›´çµæ´»çš„ DOM ä¿¡æ¯å’Œæˆªå›¾ä¼ é€’ï¼š

- `agent.aiQuery`
- `agent.aiBoolean`
- `agent.aiNumber`
- `agent.aiString`

### æ–°å¢ options å‚æ•°

- `domIncluded`ï¼šæ˜¯å¦ä¼ é€’ç²¾ç®€åçš„ DOM ä¿¡æ¯ï¼ˆé€‚ç”¨äºæå–éšè—å±æ€§ï¼Œå¦‚å›¾ç‰‡é“¾æ¥ç­‰ï¼‰ï¼Œé»˜è®¤å…³é—­ã€‚
- `screenshotIncluded`ï¼šæ˜¯å¦ä¼ é€’æˆªå›¾ï¼Œé»˜è®¤å¼€å¯ã€‚

### ä»£ç ç¤ºä¾‹

```typescript
// æå–é€šè®¯å½•ä¸­æ‰€æœ‰è”ç³»äººçš„å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…å«éšè—çš„å¤´åƒé“¾æ¥ï¼‰
const contactsData = await agent.aiQuery(
  "{name: string, id: number, company: string, department: string, avatarUrl: string}[], extract all contact information including hidden avatarUrl attributes",
  { domIncluded: true }
);

// æ£€æŸ¥é€šè®¯å½•ä¸­ç¬¬ä¸€ä¸ªè”ç³»äººçš„ id å±æ€§æ˜¯å¦ä¸º 1
const isId1 = await agent.aiBoolean(
  "Is the first contact's id is 1?",
  { domIncluded: true }
);

// è·å–ç¬¬ä¸€ä¸ªè”ç³»äººçš„ IDï¼ˆéšè—å±æ€§ï¼‰
const firstContactId = await agent.aiNumber("First contact's id?", { domIncluded: true });

// è·å–ç¬¬ä¸€ä¸ªè”ç³»äººçš„å¤´åƒ URLï¼ˆé¡µé¢ä¸Šä¸å¯è§çš„å±æ€§ï¼‰
const avatarUrl = await agent.aiString(
  "What is the Avatar URL of the first contact?",
  { domIncluded: true }
);
```

## æ–°å¢å³é”®ç‚¹å‡»èƒ½åŠ›

ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡éœ€è¦è‡ªåŠ¨åŒ–å³é”®æ“ä½œçš„åœºæ™¯ï¼Ÿç°åœ¨ï¼ŒMidscene æ”¯æŒäº†å…¨æ–°çš„ `agent.aiRightClick()` æ–¹æ³•ï¼

- **åŠŸèƒ½**ï¼šè‡ªåŠ¨å³é”®ç‚¹å‡»é¡µé¢å…ƒç´ ï¼Œé€‚ç”¨äºé‚£äº›è‡ªå®šä¹‰äº†å³é”®äº‹ä»¶çš„åœºæ™¯ï¼ˆæ³¨æ„ï¼šæ— æ³•ä¸æµè§ˆå™¨åŸç”Ÿèœå•äº¤äº’ï¼‰ã€‚
- **çœŸå®åœºæ™¯ç¤ºä¾‹**ï¼š
  ```typescript
  // åœ¨é€šè®¯å½•åº”ç”¨ä¸­å³é”®ç‚¹å‡»è”ç³»äººï¼Œè§¦å‘è‡ªå®šä¹‰ä¸Šä¸‹æ–‡èœå•
  await agent.aiRightClick("Alice Johnson", { deepThink: true });
  
  // ç„¶åå¯ä»¥ç‚¹å‡»èœå•ä¸­çš„é€‰é¡¹
  await agent.aiTap("Copy Info"); // å¤åˆ¶è”ç³»äººä¿¡æ¯åˆ°å‰ªè´´æ¿
  ```
- **å‚æ•°è¯´æ˜**ï¼š
  - `locate`: ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ è¦æ“ä½œçš„å…ƒç´ 
  - `options`: å¯é€‰ï¼Œæ”¯æŒ `deepThink`ï¼ˆAIç²¾ç»†å®šä½ï¼‰ã€`cacheable`ï¼ˆç»“æœç¼“å­˜ï¼‰

## ç¤ºä¾‹åŠå…¶æŠ¥å‘Š

### ç¤ºä¾‹é¡µé¢

<iframe src="https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/contacts3.html" width="100%" height="800"></iframe>

### ç¤ºä¾‹æŠ¥å‘Š

<iframe src="https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/puppeteer-2025-06-04_20-41-45-be8ibktz.html" width="100%" height="800"></iframe>

### ç¤ºä¾‹ä»£ç 

```typescript
import puppeteer from "puppeteer";
import os from "node:os";
import { PuppeteerAgent } from "@midscene/web/puppeteer";
import "dotenv/config"; // read environment variables from .env file

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

Promise.resolve(
  (async () => {
    const browser = await puppeteer.launch({
      headless: false, // set to 'false' to see the browser window for demo
      args: ["--no-sandbox", "--disable-setuid-sandbox"],
    });

    const page = await browser.newPage();
    await page.setViewport({
      width: 1280,
      height: 768,
      deviceScaleFactor: os.platform() === "darwin" ? 2 : 1,
    });

    // Load the contacts demo page (replace with your actual file path or URL)
    await page.goto("https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/contacts3.html");
    
    // await sleep(2000);

    // ğŸ¤– Initialize Midscene agent
    const agent = new PuppeteerAgent(page);

    console.log("ğŸš€ Starting Smart Contacts Demo with Midscene AI");
    console.log("================================================");

    // âœ¨ æ–°ç‰¹æ€§ç¤ºä¾‹ 1: aiRightClick - å³é”®ç‚¹å‡»è”ç³»äºº
    console.log("\n1. ğŸ–±ï¸ æµ‹è¯• aiRightClick åŠŸèƒ½...");
    await agent.aiRightClick("Alice Johnson", { deepThink: true });
    await sleep(1000);
    console.log("âœ… æˆåŠŸå³é”®ç‚¹å‡» Alice Johnson çš„è”ç³»äººå¡ç‰‡");
    
    // Click on "Copy Info" option in context menu
    await agent.aiTap("Copy Info");
    await sleep(1000);
    console.log("âœ… æˆåŠŸè§¦å‘ 'Copy Info' æ“ä½œ");

    // âœ¨ æ–°ç‰¹æ€§ç¤ºä¾‹ 2: aiQuery with domIncluded - æå–åŒ…å«éšè—å±æ€§çš„è”ç³»äººæ•°æ®
    console.log("\n2. ğŸ“Š æµ‹è¯• aiQuery with domIncluded åŠŸèƒ½...");
    const contactsData = await agent.aiQuery(
      "{name: string, id: number, company: string, department: string, avatarUrl: string}[], æå–æ‰€æœ‰è”ç³»äººä¿¡æ¯ï¼ŒåŒ…æ‹¬éšè—çš„ avatarUrl å±æ€§",
      { domIncluded: true }
    );
    console.log("âœ… æˆåŠŸæå–åŒ…å«éšè—å±æ€§çš„è”ç³»äººæ•°æ®:");
    console.log(JSON.stringify(contactsData, null, 2));

    // âœ¨ æ–°ç‰¹æ€§ç¤ºä¾‹ 3: aiBoolean with domIncluded - æ£€æŸ¥ ID å­—æ®µ
    console.log("\n3. â“ æµ‹è¯• aiBoolean with domIncluded åŠŸèƒ½...");
    const isId1 = await agent.aiBoolean(
      "ç¬¬ä¸€ä¸ªè”ç³»äººçš„ id æ˜¯å¦ä¸º 1?",
      { domIncluded: true }
    );
    console.log("âœ… ç¬¬ä¸€ä¸ªè”ç³»äººçš„ id æ˜¯å¦ä¸º 1?", isId1);

    // âœ¨ æ–°ç‰¹æ€§ç¤ºä¾‹ 4: aiNumber - with domIncluded - ç»Ÿè®¡è”ç³»äººæ•°é‡
    console.log("\n4. ğŸ”¢ æµ‹è¯• aiNumber with domIncluded åŠŸèƒ½...");
    const contactCount = await agent.aiNumber("ç¬¬ä¸€ä¸ªè”ç³»äººçš„ id?", { domIncluded: true });
    console.log("âœ… ç¬¬ä¸€ä¸ªè”ç³»äººçš„ id:", contactCount);

    // âœ¨ æ–°ç‰¹æ€§ç¤ºä¾‹ 5: aiString with domIncluded - è·å–ç¬¬ä¸€ä¸ªè”ç³»äººçš„ ID
      console.log("\n5. ğŸ†” æµ‹è¯• aiString with domIncluded åŠŸèƒ½...");
    const firstContactId = await agent.aiString(
      "ç¬¬ä¸€ä¸ªè”ç³»äººçš„å¤´åƒ URL æ˜¯ä»€ä¹ˆ?",
      { domIncluded: true }
    );
    console.log("âœ… ç¬¬ä¸€ä¸ªè”ç³»äººçš„å¤´åƒ URL:", firstContactId);

    console.log("\nğŸ‰ æ™ºèƒ½é€šè®¯å½•æ¼”ç¤ºå®Œæˆ!");
    console.log("================================================");
    console.log("âœ¨ æ–° Midscene ç‰¹æ€§ç¤ºä¾‹:");
    console.log("   â€¢ aiRightClick() with deepThink - è‡ªå®šä¹‰ä¸Šä¸‹æ–‡èœå•");
    console.log("   â€¢ aiQuery() with domIncluded - æå–éšè— ID å±æ€§");
    console.log("   â€¢ aiBoolean() with domIncluded - DOM åŸºäºå¸ƒå°”æ£€æŸ¥");
    console.log("   â€¢ aiNumber() - with domIncluded - éšè— ID å±æ€§");
    console.log("   â€¢ aiString() with domIncluded - æå–éšè—å¤´åƒ URL å€¼");

    // ä¿æŒæµè§ˆå™¨æ‰“å¼€å‡ ç§’é’Ÿä»¥æŸ¥çœ‹ç»“æœ
    await sleep(3000);
    await browser.close();
  })()
);
```

**æ¬¢è¿ä½“éªŒæ–°ç‰ˆ Midscene APIï¼Œæ›´å¤šè‡ªåŠ¨åŒ–å¯èƒ½ç­‰ä½ æ¥å‘ç°ï¼**

å¦‚æœ‰å»ºè®®ï¼Œæ¬¢è¿åœ¨ [GitHub](https://github.com/web-infra-dev/midscene/issues) æäº¤ Issueã€‚
