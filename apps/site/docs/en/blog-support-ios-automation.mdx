# Support iOS automation

From Midscene v0.29, we are happy to announce the support for iOS automation. The era for AI-driven iOS automation is here!

## Showcases

### Auto-like tweets

Open Twitter and auto-like the first tweet by [@midscene_ai](https://x.com/midscene_ai).

<video src="https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/ios-twitter.mp4" controls/>

## Suitable for all apps

For our developers, all you need is the WebDriver Server and a visual-language model (vl-model) service. Everything is ready!

Behind the scenes, we utilize the visual grounding capabilities of vl-model to locate target elements on the screen. So, regardless of whether it's a native iOS app, a Safari web page, or a hybrid app with a WebView, it makes no difference. Developers can write automation scripts without the burden of worrying about the technology stack of the app.

## With all the power of Midscene

When using Midscene to do web automation, our users loves the tools like playgrounds and reports. Now, we bring the same power to iOS automation!

### Use the playground to run automation without any code

<video src="https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/ios-playground-demo.mp4" controls/>

### Use the report to replay the whole process

<video src="https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/ios-twitter.mp4" controls/>

### Write the automation scripts by YAML file

Open Safari on iOS device, search for content and extract information.

```yaml
# Open Safari browser on iOS device, search for content and extract information

ios:
  deviceId: "iPhone"
  bundleId: "com.apple.mobilesafari"

tasks:
  - name: search content
    flow:
      - aiAction: tap address bar
      - aiAction: input 'Midscene AI automation'
      - aiAction: tap search button
      - sleep: 3000
      - aiAction: scroll down 500px

  - name: extract search results
    flow:
      - aiQuery: >
          {title: string, url: string, description: string}[],
          return search result titles, links and descriptions
        name: searchResults

  - name: verify page elements
    flow:
      - aiAssert: there is a search results list on the page
```

### Use the JavaScript SDK

Use the javascript SDK to do the automation by code.

```ts
import { IOSAgent, IOSDevice } from '@midscene/ios';
import "dotenv/config"; // read environment variables from .env file

const sleep = (ms) => new Promise((r) => setTimeout(r, ms));
Promise.resolve(
  (async () => {
    // ðŸ‘€ initialize iOS device
    const device = new IOSDevice({
      deviceId: 'iPhone',
      bundleId: 'com.apple.mobilesafari'
    });

    // ðŸ‘€ initialize Midscene agent
    const agent = new IOSAgent(device, {
      aiActionContext:
        'If any permission popup appears, tap allow. If login page pops up, skip it.',
    });

    await device.connect();
    await device.launchApp();

    await sleep(3000);

    // ðŸ‘€ tap address bar and input search keywords
    await agent.aiAction('tap address bar and input "Midscene automation"');

    // ðŸ‘€ perform search
    await agent.aiAction('tap search button');

    // ðŸ‘€ wait for loading to complete
    await agent.aiWaitFor("there is at least one search result on the page");
    // or you may use a plain sleep:
    // await sleep(5000);

    // ðŸ‘€ understand page content, find search results
    const results = await agent.aiQuery(
      "{title: string, url: string}[], find titles and links in search results list"
    );
    console.log("search results", results);

    // ðŸ‘€ assert by AI
    await agent.aiAssert("relevant search results are displayed on the page");
  })()
);

```

### Two style APIs to do interaction

The auto-planning style:

```javascript
await agent.ai('tap address bar and input "Midscene automation", then search');
```

The instant action style:

```javascript
await agent.aiTap('address bar');
await agent.aiInput('Midscene automation', 'address bar');
await agent.aiTap('search button');
```

## Quick start

You can use the playground to experience the iOS automation without any code. Please refer to [Quick experience with iOS](./quick-experience-with-ios) for more details.

After the experience, you can integrate with the iOS device by javascript code. Please refer to [Integrate with iOS(WebDriverAgent)](./integrate-with-ios) for more details.

If you prefer the yaml file for automation scripts, please refer to [Automate with scripts in yaml](./automate-with-scripts-in-yaml).

### Demo projects

We have prepared a demo project for javascript SDK:

[JavaScript demo project](https://github.com/web-infra-dev/midscene-example/blob/main/ios/javascript-sdk-demo)

If you want to use the automation for testing purpose, you can use the javascript with vitest. We have setup a demo project for you to see how it works:

[Vitest demo project](https://github.com/web-infra-dev/midscene-example/blob/main/ios/vitest-demo)

You can also write the automation scripts by yaml file:

[YAML demo project](https://github.com/web-infra-dev/midscene-example/blob/main/ios/yaml-scripts-demo)

## Limitations

1. Element location caching is not supported due to lack of XPath support. However, planning cache (for `.ai` and `.aiAction` methods) is fully supported to improve execution efficiency.
2. Requires macOS environment and Xcode support.
3. Physical devices need to enable Developer Mode and trust development certificates.
4. LLMs like gpt-4o or deepseek are not supported. Only some known vl models with visual grounding ability are supported for now. If you want to introduce other vl models, please let us know.
5. The performance is not good enough for now. We are still working on it.
6. The vl model may not perform well on `.aiQuery` and `.aiAssert`. We will give a way to switch model for different kinds of tasks.

## Credits

We would like to thank the following projects:

- [Appium](https://appium.io/) for providing a powerful WebDriver implementation for iOS automation.
- [WebDriverAgent](https://github.com/appium/WebDriverAgent) for JavaScript manipulation of XCTest.
- [XCUITest](https://developer.apple.com/documentation/xctest/xcuitest) Apple's UI testing framework.