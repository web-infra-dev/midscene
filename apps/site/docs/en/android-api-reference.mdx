# API reference (Android)

Use this doc when you need to customize Midscene's Android automation or review Android-only constructor options. For shared parameters (reporting, hooks, caching, etc.), see the platform-agnostic [API reference (Common)](./api).

## AndroidDevice {#androiddevice}

Create a connection to an adb-managed device that an AndroidAgent can drive.

### Import

```ts
import { AndroidDevice, getConnectedDevices } from '@midscene/android';
```

### Constructor

```ts
const device = new AndroidDevice(deviceId, {
  // device options...
});
```

### Device options

- `deviceId: string` &mdash; Value returned by `adb devices` or `getConnectedDevices()`.
- `autoDismissKeyboard?: boolean` &mdash; Automatically hide the keyboard after input. Default `true`.
- `keyboardDismissStrategy?: 'esc-first' | 'back-first'` &mdash; Order for dismissing keyboards. Default `'esc-first'`.
- `androidAdbPath?: string` &mdash; Custom path to the adb executable.
- `remoteAdbHost?: string` / `remoteAdbPort?: number` &mdash; Point to a remote adb server.
- `imeStrategy?: 'always-yadb' | 'yadb-for-non-ascii'` &mdash; Choose when to invoke [yadb](https://github.com/ysbing/YADB) for text input. Default `'yadb-for-non-ascii'`.
- `displayId?: number` &mdash; Target a specific virtual display if the device mirrors multiple displays.
- `screenshotResizeScale?: number` &mdash; Downscale screenshots before sending them to the model. Defaults to `1 / devicePixelRatio`.
- `alwaysRefreshScreenInfo?: boolean` &mdash; Re-query rotation and screen size every step. Default `false`.

### Usage notes

- Discover devices with `getConnectedDevices()`; the `udid` matches `adb devices`.
- Supports remote adb via `remoteAdbHost/remoteAdbPort`; set `androidAdbPath` if adb is not on PATH.
- Use `screenshotResizeScale` to cut latency on high-DPI devices.

### Examples

#### Quick start

```ts
import { AndroidAgent, AndroidDevice, getConnectedDevices } from '@midscene/android';

const [first] = await getConnectedDevices();
const device = new AndroidDevice(first.udid);
await device.connect();

const agent = new AndroidAgent(device, {
  aiActionContext: 'If a permissions dialog appears, accept it.',
});

await agent.launch('https://www.ebay.com');
await agent.aiAct('search "Headphones" and wait for results');
const items = await agent.aiQuery(
  '{itemTitle: string, price: number}[], find item in list and corresponding price',
);
console.log(items);
```

#### Launch native packages

```ts
await agent.launch('com.android.settings/.Settings');
await agent.back();
await agent.home();
```

## AndroidAgent {#androidagent}

Wire Midscene's AI planner to an AndroidDevice for UI automation.

### Import

```ts
import { AndroidAgent } from '@midscene/android';
```

### Constructor

```ts
const agent = new AndroidAgent(device, {
  // common agent options...
});
```

### Android-specific options

- `customActions?: DeviceAction[]` &mdash; Extend planning with actions defined via `defineAction`.
- All other fields match [API constructors](./api#common-parameters): `generateReport`, `reportFileName`, `aiActionContext`, `modelConfig`, `cacheId`, `createOpenAIClient`, `onTaskStartTip`, and more.

### Usage notes

:::info

- Use one agent per device connection.
- Android-only helpers such as `launch` and `runAdbShell` are also exposed in YAML scripts. See [Android platform-specific actions](./automate-with-scripts-in-yaml#the-android-part).
- For shared interaction methods, see [API reference (Common)](./api#interaction-methods).

:::

### Android-specific methods

#### `agent.launch()`

Launch a web URL or native Android activity/package.

```ts
function launch(uri: string): Promise<void>;
```

- `uri: string` &mdash; Either a webpage URL or a package/`package/.Activity` string such as `com.android.settings/.Settings`.

#### `agent.runAdbShell()`

Run a raw `adb shell` command through the connected device.

```ts
function runAdbShell(command: string): Promise<string>;
```

- `command: string` &mdash; Command passed verbatim to `adb shell`.

```ts
const result = await agent.runAdbShell('dumpsys battery');
console.log(result);
```

#### Navigation helpers

- `agent.back(): Promise<void>` &mdash; Trigger the Android system Back action.
- `agent.home(): Promise<void>` &mdash; Return to the launcher.
- `agent.recentApps(): Promise<void>` &mdash; Open the Recents/Overview screen.

### Helper utilities

#### `agentFromAdbDevice()`

Create an `AndroidAgent` from any connected adb device.

```ts
function agentFromAdbDevice(
  deviceId?: string,
  opts?: PageAgentOpt & AndroidDeviceOpt,
): Promise<AndroidAgent>;
```

- `deviceId?: string` &mdash; Connect to a specific device; omitted means “first available”.
- `opts?: PageAgentOpt & AndroidDeviceOpt` &mdash; Combine agent options with [AndroidDevice](#androiddevice) settings.

#### `getConnectedDevices()`

Enumerate adb devices Midscene can drive.

```ts
function getConnectedDevices(): Promise<Array<{
  udid: string;
  state: string;
  port?: number;
}>>;
```

### See also

- [Android getting started](./android-getting-started) for setup and scripting steps.
