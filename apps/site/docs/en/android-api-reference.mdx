# API reference(Android)

Use this section when you need to customize device behavior, wire Midscene into your framework, or troubleshoot adb issues. For the shared constructor options (reporting, hooks, caching, etc.) see the platform-agnostic [API reference](./api.mdx) plus [Prompting tips](./prompting-tips) if you need help crafting instructions.

## Import and basic usage

To work with Android devices, import the Android SDK package:

```typescript
import {
  AndroidAgent,
  AndroidDevice,
  getConnectedDevices,
} from '@midscene/android';
```

Basic usage:

```typescript
const devices = await getConnectedDevices();
const device = new AndroidDevice(devices[0].udid);
await device.connect();

const agent = new AndroidAgent(device, {
  actionContext: 'If a permissions dialog appears, accept it.',
});
```

## AndroidDevice constructor {#androiddevice-constructor}

```ts
new AndroidDevice(deviceId: string, opts?: AndroidDeviceOpt)
```

- `deviceId: string` &mdash; Value returned by `adb devices` or `getConnectedDevices()`.
- `autoDismissKeyboard?: boolean` &mdash; Automatically hide the keyboard after input. Default `true`.
- `keyboardDismissStrategy?: 'esc-first' | 'back-first'` &mdash; Order for dismissing keyboards. Default `'esc-first'`.
- `androidAdbPath?: string` &mdash; Custom path to the adb executable.
- `remoteAdbHost?: string` / `remoteAdbPort?: number` &mdash; Point to a remote adb server.
- `imeStrategy?: 'always-yadb' | 'yadb-for-non-ascii'` &mdash; Choose when to invoke [yadb](https://github.com/ysbing/YADB) for text input. Default `'yadb-for-non-ascii'`.
- `displayId?: number` &mdash; Target a specific virtual display if the device mirrors multiple displays.
- `screenshotResizeScale?: number` &mdash; Downscale screenshots before sending them to the model. Defaults to `1 / devicePixelRatio`.
- `alwaysRefreshScreenInfo?: boolean` &mdash; Re-query rotation and screen size every step. Default `false`.

## AndroidAgent constructor {#androidagent}

```ts
new AndroidAgent(device: AndroidDevice, options?: PageAgentOpt)
```

- `device: AndroidDevice` (required) handles screenshots, taps, text input, back/home key events, etc. Configure device behavior via the constructor above and `getConnectedDevices()`.
- `options?: PageAgentOpt` matches the common agent options documented in [API constructors](./api#common-parameters): `generateReport`, `reportFileName`, `actionContext`/`aiActionContext`, `modelConfig`, `cacheId`, `customActions`, `createOpenAIClient`, `onTaskStartTip`, and more.
- Helper factory: `agentFromAdbDevice(deviceId?, opts?)` connects to an adb device and returns a ready-to-use agent if you prefer a single call.
- Utilities: `getConnectedDevices()` enumerates adb devices; YAML workflows inherit the same fields described in [Automate with scripts in YAML](./automate-with-scripts-in-yaml).

## Android agent methods

### `agent.launch()`

Launch a web URL or native Android activity/package.

```typescript
function launch(uri: string): Promise<void>;
```

- `uri: string` &mdash; Either a webpage URL or a package/`package/.Activity` string such as `com.android.settings/.Settings`.

```typescript
const agent = new AndroidAgent(device);
await agent.launch('https://www.ebay.com');
await agent.launch('com.android.settings');
await agent.launch('com.android.settings/.Settings');
```

### `agent.runAdbShell()`

Run a raw `adb shell` command through the connected device.

```typescript
function runAdbShell(command: string): Promise<string>;
```

- `command: string` &mdash; Command passed verbatim to `adb shell`.

```typescript
const result = await agent.runAdbShell('dumpsys battery');
console.log(result);
```

:::info YAML usage
Android-only helpers such as `launch` and `runAdbShell` are also exposed in YAML scripts. See [Android platform-specific actions](./automate-with-scripts-in-yaml#the-android-part) for syntax.
:::

### `agent.back()`

Trigger the Android system Back action.

```typescript
function back(): Promise<void>;
```

### `agent.home()`

Return to the launcher.

```typescript
function home(): Promise<void>;
```

### `agent.recentApps()`

Open the Recents/Overview screen.

```typescript
function recentApps(): Promise<void>;
```

## Android helper utilities

### `agentFromAdbDevice()`

Create an `AndroidAgent` from any connected adb device.

```typescript
function agentFromAdbDevice(
  deviceId?: string,
  opts?: PageAgentOpt & AndroidDeviceOpt,
): Promise<AndroidAgent>;
```

- `deviceId?: string` &mdash; Connect to a specific device; omitted means “first available”.
- `opts?: PageAgentOpt & AndroidDeviceOpt` &mdash; Combine agent options with [AndroidDevice constructor](#androiddevice-constructor) settings.

### `getConnectedDevices()`

Enumerate adb devices Midscene can drive.

```typescript
function getConnectedDevices(): Promise<Array<{
  udid: string;
  state: string;
  port?: number;
}>>;
```
