# First YAML file - Performs login and sets all storage
web:
  serve: ../server_root
  url: /share-context-test.html
  viewportWidth: 800
  viewportHeight: 600

tasks:
  - name: Login and set storage
    flow:
      # Click login button to set cookie, localStorage, and sessionStorage
      - aiAction: click the "Login (Set All Storage)" button

      # Wait a moment for the storage to be set
      - sleep: 500

      # Verify login was successful in this first file
      - aiAssert: the status shows "Logged in"

      # Log the storage state after login
      - evaluateJavaScript: |
          console.log('=== First YAML File - After Login ===');
          console.log('Cookies:', document.cookie);
          console.log('LocalStorage:', JSON.stringify(localStorage));
          console.log('SessionStorage:', JSON.stringify(sessionStorage));
          const cookies = document.cookie.split(';').reduce((acc, cookie) => {
            const [key, value] = cookie.trim().split('=');
            acc[key] = value;
            return acc;
          }, {});
          return {
            cookie_authToken: cookies.authToken || 'MISSING',
            localStorage_userId: localStorage.getItem('userId') || 'MISSING',
            localStorage_userName: localStorage.getItem('userName') || 'MISSING',
            sessionStorage_sessionId: sessionStorage.getItem('sessionId') || 'MISSING'
          };
        name: first_file_storage_state
